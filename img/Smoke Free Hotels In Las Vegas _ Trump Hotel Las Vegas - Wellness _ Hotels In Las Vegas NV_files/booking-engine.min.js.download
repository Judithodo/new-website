var eventsMTemplate,eventsLTemplate,noEventsTemplate,eventData=[],today=new Date,tomorrow=new Date(today),calState=moment(today),HOTELNAME=$("body").data("property"),SYNXISID=$("body").data("synxisid");function sabreDateFormat(e){return moment(e).format("YYYY-MM-DD")}$(function(){var c,s,r;tomorrow.setDate(today.getDate()+1);var i=today.getFullYear()+"-"+("00"+(today.getMonth()+1)).slice(-2).toString()+"-"+("00"+today.getDate()).slice(-2).toString(),d=tomorrow.getFullYear()+"-"+("00"+(tomorrow.getMonth()+1)).slice(-2).toString()+"-"+("00"+tomorrow.getDate()).slice(-2).toString();$(".header").on("click",".menu-trigger",function(e){e.preventDefault();var t=$(this);t.hasClass("active")?(t.removeClass("active").find(".navicon").removeClass("close"),t.closest(".header-wrapper").find(".nav-wrapper").removeClass("show-nav"),$(".header .languages").hide(),$(window).outerWidth()<=768&&$(".nav-wrapper .languages").hide()):(t.addClass("active").find(".navicon").addClass("close"),t.closest(".header-wrapper").find(".nav-wrapper").addClass("show-nav"),$(".nav-wrapper .languages").show(),$(".lang-trigger").removeClass("active"))}),$("body").each(function(){var e=$(this);$.ajax({url:"/templates/main/js/templates/general-booking-templates.html",cache:!0,success:function(e){Handlebars.registerPartial("cart_stay_info",$(e).filter("#cart-your-stay").html()),Handlebars.registerPartial("cart_room_info",$(e).filter("#cart-room-info").html()),eventsMTemplate=Handlebars.compile($(e).filter("#events-medium").html()),eventsLTemplate=Handlebars.compile($(e).filter("#events-large").html()),noEventsTemplate=Handlebars.compile($(e).filter("#no-events").html()),c=Handlebars.compile($(e).filter("#cart").html()),s=Handlebars.compile($(e).filter("#needs-to-call-lightbox").html()),confirmCancellation=Handlebars.compile($(e).filter("#confirm-cancellation-lightbox").html()),errors=Handlebars.compile($(e).filter("#errors").html())}}),myCart.init(".icbe-wrapper");var o=[],t=[];if(t.weModifying="new",getQueryVariable("cancelling")&&(t.weModifying="cancelling"),getQueryVariable("modifying")&&(t.weModifying="modifying"),$("body").hasClass("calendar")&&t){var r=e.find('input[name="startdate"]').val(),n=e.find('input[name="enddate"]').val();$(".search-form").each(function(){var e=$(this);""===r?(e.find('input[name="startdate"]').val(i),e.find(".check-in .selected-date").html('<span class="month">'+moment(today).format("MMM")+'</span><span class="day">'+moment(today).format("DD")+"</span>")):e.find(".check-in .selected-date").html('<span class="month">'+moment(r).format("MMM")+'</span><span class="day">'+moment(r).format("DD")+"</span>"),""===n?(e.find('input[name="enddate"]').val(d),e.find(".check-out .selected-date").html('<span class="month">'+moment(tomorrow).format("MMM")+'</span><span class="day">'+moment(tomorrow).format("DD")+"</span>")):e.find(".check-out .selected-date").html('<span class="month">'+moment(n).format("MMM")+'</span><span class="day">'+moment(n).format("DD")+"</span>")}),$(".calendar-icon-wrapper").on("click",function(e){e.preventDefault(),1024<$(window).width()&&($("body").scrollTop()<=Math.floor($(".icbe-wrapper").offset().top/2)?$("body").animate({scrollTop:$(".icbe-wrapper").offset().top},500):($(".date-picker").addClass("bounceIn"),setTimeout(function(){$(".date-picker").removeClass("bounceIn")},1e3)))}),$(".extra-search-button").on("click",".button",function(){$(".search-form").trigger("submit")}),""!==getQueryVariable("currency")&&$(".currency-selector").val(getQueryVariable("currency")),""===getQueryVariable("editmode")||"true"!==getQueryVariable("editmode")||""===getQueryVariable("modifying")&&"true"!==getQueryVariable("modifying")?$.when($.ajax({url:"/ajax/clearcart"})).then(function(){$(".events-wrapper").loadEvents(),$(".rate-calendar-wrapper").each(function(){var e=$(this),t={months:4,promocode:{value:"",button:void 0},currency:$(".currency-selector").val(),ratecodes:{value:getQueryVariable("ratecodes")}},a=getQueryVariable("roomtype");a&&($(".search-form").append($("<input/>",{type:"hidden",name:"roomtype",value:a})),t.roomtype=a),getQueryVariable("startdate")&&getQueryVariable("enddate")&&(t.startdate=moment(r),t.enddate=moment(n)),getQueryVariable("promocode")&&""!==getQueryVariable("promocode")&&(t.promocode.value=getQueryVariable("promocode")),$(window).width()<=1024&&$(".search-form .fields-wrapper > .column:nth-child(2)").append(e),e.find(".date-picker").rateCalendar(t)})}):myCart.getCartData(t).then(function(){myCart.update(),$(".events-wrapper").loadEvents(),$(".rate-calendar-wrapper").each(function(){var e=$(this),t={months:4,promocode:{value:"",button:void 0},currency:$(".currency-selector").val(),ratecodes:{value:getQueryVariable("ratecodes")}},a=getQueryVariable("roomtype");a&&($(".search-form").append($("<input/>",{type:"hidden",name:"roomtype",value:a})),t.roomtype=a),getQueryVariable("startdate")&&getQueryVariable("enddate")&&(t.startdate=moment(r),t.enddate=moment(n)),getQueryVariable("promocode")&&""!==getQueryVariable("promocode")&&(t.promocode.value=getQueryVariable("promocode")),$(window).width()<=1024&&$(".search-form .fields-wrapper > .column:nth-child(2)").append(e),e.find(".date-picker").rateCalendar(t)})})}if($("body").hasClass("roomlist")){var a=[];a.startdate=moment().format("YYYY-MM-DD"),a.enddate=moment().format("YYYY-MM-DD"),a.currency="USD",a.adults=2,a.children=0,a.numrooms=1,a.promocode="",a.ratecodes="",a.iata="",a.roomtype="",myCart.getCartData(t).then(function(){o=myCart.getCartView(),getQueryVariable("currency")!==myCart.getCurrency()&&""!==getQueryVariable("currency")?""!==getQueryVariable("editmode")&&"true"===getQueryVariable("editmode")||""!==getQueryVariable("modifying")&&"true"===getQueryVariable("modifying")?$.ajax({url:"/ajax/setcurrency?currency="+getQueryVariable("currency").toString(),success:function(){myCart.getCartData(t).then(function(){var e=myCart.getRoom(Math.ceil(o.stayInfo.totalRooms-1));myCart.update(),a.startdate=o.stayInfo.startdate,a.enddate=o.stayInfo.enddate,a.currency=myCart.getCurrency(),a.adults=e.rooms[0].adults,a.children=e.rooms[0].children,""!==getQueryVariable("rooms")&&(a.numrooms=parseInt(getQueryVariable("rooms"),10)),jQuery.isEmptyObject(e.rooms[0].promocode)?a.promocode="":a.promocode=e.rooms[0].promocode,a.ratecode=e.rooms[0].ratecode,$(".room-listing").roomslisting({searchparams:a})})}}):$.when($.ajax({url:"/ajax/clearcart"})).done(function(){$.ajax({url:"/ajax/setcurrency?currency="+getQueryVariable("currency").toString(),success:function(){myCart.getCartData(t).then(function(){myCart.update(),""!==getQueryVariable("startdate")&&(a.startdate=getQueryVariable("startdate").toString()),""!==getQueryVariable("enddate")&&(a.enddate=getQueryVariable("enddate").toString()),""!==getQueryVariable("currency")&&(a.currency=getQueryVariable("currency").toString()),""!==getQueryVariable("adults")&&(a.adults=parseInt(getQueryVariable("adults"),10)),""!==getQueryVariable("children")&&(a.children=parseInt(getQueryVariable("children"),10)),""!==getQueryVariable("rooms")&&(a.numrooms=parseInt(getQueryVariable("rooms"),10)),""!==getQueryVariable("promocode")&&(a.promocode=getQueryVariable("promocode").toString()),""!==getQueryVariable("ratecodes")&&(a.ratecodes=getQueryVariable("ratecodes").toString()),""!==getQueryVariable("iata")&&(a.iata=getQueryVariable("iata").toString()),""!==getQueryVariable("roomtype")&&(a.roomtype=getQueryVariable("roomtype").toString()),$(".room-listing").roomslisting({searchparams:a})})}})}):""!==getQueryVariable("editmode")&&"true"===getQueryVariable("editmode")||""===getQueryVariable("modifying")&&"true"===getQueryVariable("modifying")?myCart.getCartData(t).then(function(){var e=myCart.getRoom(Math.ceil(o.stayInfo.totalRooms-1));""!==getQueryVariable("cartid")&&(e=myCart.getRoom(Number(getQueryVariable("cartid")))),myCart.update(),a.startdate=o.stayInfo.startdate,a.enddate=o.stayInfo.enddate,a.currency=myCart.getCurrency(),a.adults=e.rooms[0].adults,a.children=e.rooms[0].children,void 0!==getQueryVariable("rooms")&&(a.numrooms=parseInt(getQueryVariable("rooms"),10)),jQuery.isEmptyObject(e.rooms[0].promocode)?a.promocode="":a.promocode=e.rooms[0].promocode,jQuery.isEmptyObject(e.rooms[0].ratecode)?a.ratecodes="":a.ratecodes=e.rooms[0].ratecode,a.cartId=getQueryVariable("cartid"),$(".room-listing").roomslisting({searchparams:a})}):$.when($.ajax({url:"/ajax/clearcart"})).done(function(){""!==getQueryVariable("startdate")&&(a.startdate=getQueryVariable("startdate").toString()),""!==getQueryVariable("enddate")&&(a.enddate=getQueryVariable("enddate").toString()),""!==getQueryVariable("currency")&&(a.currency=getQueryVariable("currency").toString()),""!==getQueryVariable("adults")&&(a.adults=parseInt(getQueryVariable("adults"),10)),""!==getQueryVariable("children")&&(a.children=parseInt(getQueryVariable("children"),10)),""!==getQueryVariable("rooms")&&(a.numrooms=parseInt(getQueryVariable("rooms"),10)),""!==getQueryVariable("promocode")&&(a.promocode=getQueryVariable("promocode").toString()),""!==getQueryVariable("ratecodes")&&(a.ratecodes=getQueryVariable("ratecodes").toString()),""!==getQueryVariable("iata")&&(a.iata=getQueryVariable("iata").toString()),""!==getQueryVariable("roomtypes")&&(a.roomtypes=getQueryVariable("roomtypes").toString()),a.cartId=getQueryVariable("cartid"),$(".room-listing").roomslisting({searchparams:a})})})}$("body").hasClass("addons")&&myCart.getCartData(t).then(function(){o=myCart.getCartView(),myCart.update(),$(".addons-wrapper").length&&$(".addons-wrapper").roomaddons({quick:!1})}),e.hasClass("guest-information")&&myCart.getCartData(t).then(function(){myCart.update(),o=myCart.getCartView();var e=myCart.getStayInfo(),a=[];void 0!==e.startdate&&$("#cart-view").html(c(o)),$("#cart-view").find(".continue").on("click",function(e){e.preventDefault(),$("#cart-view").removeClass("active"),$("#cart").removeClass("active")}),"modifying"==o.cartState&&($("#cart-view").find(".continue").hide(),$("#guest-information").populateForm(o),$("#cart-view").find(".buttons .column").html('<button class="button cancelling" href="/booking/guest-information?cancelling=true">Cancel Reservation</button>')),$(".quick-addons-wrapper").length&&$(".quick-addons-wrapper").roomaddons({quick:!0}),$.each(o.roomsInfo.rooms,function(e,t){a.push({name:t.roomName,id:t.roomId,price:t.averageRate,brand:HOTELNAME,category:"Room",variant:t.rateCode,quantity:moment(o.stayInfo.enddate).diff(moment(o.stayInfo.startdate),"days").toString()}),$.isEmptyObject(t.packages.record)||(void 0===t.packages.record.length&&(t.packages.record=fixArray(t.packages.record)),$.each(t.packages.record,function(e,t){a.push({name:t.title,id:addon["@attributes"].code,price:addon["@attributes"].price,brand:HOTELNAME,category:"",quantity:addon["@attributes"].adults})}))}),$("#cart").addClass("active"),$("#cart-view").addClass("active")})}),$(".print").on("click",function(e){e.preventDefault(),window.print()}),$("body").on("click",".alert-box .close",function(e){e.preventDefault(),$(this).closest(".alert-box").removeClass("shown"),setTimeout(function(){$("body").find(".alert-box:not(.shown)").remove()},750)}),$("body").on("click",".cart-promo",function(e){e.preventDefault();var t=$(this);t.hasClass("active")?(t.removeClass("active"),t.parent().next(".add-promo-code").removeClass("active")):(t.addClass("active"),t.parent().next(".add-promo-code").addClass("active"))}),$("body").on("click",".add-promo-code .close",function(e){e.preventDefault(),$(this).parent().removeClass("active"),$(this).closest(".column").find(".cart-promo, .promo").removeClass("active")}),$(".launch-calendar").on("click",function(e){e.preventDefault();var t=$(this);if($(window).width()<=1024){var a=t.closest(".check-in-out").next(".rate-calendar-wrapper");TweenLite.to(a,.75,{height:a.outerHeight(),ease:Power3.easeOut,onStart:function(){a.css({overflow:"hidden",height:"0"}).show()},onComplete:function(){a.addClass("active").removeAttr("style")}})}}),$(".booking").on("click",".promo-codes label a",function(e){e.preventDefault();var t=$(this),a=$(this).closest("label"),o=$(this).closest(".promo-codes"),r=t.attr("data-code-type"),n=new TimelineLite;t.hasClass("active")||(a.find("a").removeClass("active"),t.addClass("active"),n.fromTo(o.find(".code-wrapper.active"),.25,{opacity:1,scale:1},{opacity:0,scale:.8,clearProps:"transform",ease:Back.easeIn,onComplete:function(){o.find(".code-wrapper.active").removeClass("active")}}).fromTo(o.find(".code-wrapper[data-code-type="+r+"]"),.25,{opacity:0,scale:.9},{opacity:1,scale:1,clearProps:"transform",ease:Back.easeOut,onStart:function(){o.find(".code-wrapper[data-code-type="+r+"]").addClass("active")}}))}),$(".calendar").on("click",".code-wrapper .apply-code",function(e){e.preventDefault();var t=$(this),a=t.closest(".code-wrapper").find('input[type="text"]').val(),o=t.closest(".code-wrapper").attr("data-code-type"),r=t.closest(".search-form").find(".rate-calendar-wrapper"),n=t.closest("form").find('input[name="startdate"]').val(),s=t.closest("form").find('input[name="enddate"]').val();switch(o){case"promocode":if(t.hasClass("disabled"))$("body").waveLoader({bars:8,overlay:!0,fixedHeight:!0}),$(window).width()<=1024&&(r.hasClass("active")||TweenLite.to(r,.75,{height:r.outerHeight(),ease:Power3.easeOut,onStart:function(){r.css({overflow:"hidden",height:"0"}).show()},onComplete:function(){r.addClass("active").removeAttr("style")}})),$(".date-picker").each(function(){$(this).rateCalendar({months:4,startdate:new Date(moment(n).get("year"),moment(n).get("month"),moment(n).get("date")),enddate:new Date(moment(s).get("year"),moment(s).get("month"),moment(s).get("date")),currency:$(".currency-selector").val(),promocode:{value:"",button:t}})});else{var i;i=t.closest("form").find('input[name="ratecodes"]').val(),""!==a?(t.closest("form").find('[name="promocode"]').val(a),$(window).width()<=1024&&(r.hasClass("active")||TweenLite.to(r,.75,{height:r.outerHeight(),ease:Power3.easeOut,onStart:function(){r.css({overflow:"hidden",height:"0"}).show()},onComplete:function(){r.addClass("active").removeAttr("style")}})),$("body").waveLoader({bars:8,overlay:!0,fixedHeight:!0}),$(".date-picker").each(function(){$(this).rateCalendar({months:4,startdate:new Date(moment(n).get("year"),moment(n).get("month"),moment(n).get("date")),enddate:new Date(moment(s).get("year"),moment(s).get("month"),moment(s).get("date")),currency:$(".currency-selector").val(),promocode:{value:a,button:t},ratecodes:{value:i}})})):alert("Cannot apply a code you haven't entered. Please enter a code and try again.")}break;case"group":if(t.hasClass("disabled"))$("body").waveLoader({bars:8,overlay:!0,fixedHeight:!0}),$(window).width()<=1024&&(r.hasClass("active")||TweenLite.to(r,.75,{height:r.outerHeight(),ease:Power3.easeOut,onStart:function(){r.css({overflow:"hidden",height:"0"}).show()},onComplete:function(){r.addClass("active").removeAttr("style")}})),$(".date-picker").each(function(){$(this).rateCalendar({months:4,startdate:new Date(moment(n).get("year"),moment(n).get("month"),moment(n).get("date")),enddate:new Date(moment(s).get("year"),moment(s).get("month"),moment(s).get("date")),currency:$(".currency-selector").val(),promocode:{value:d},ratecodes:{value:"",button:t}})});else{var d="";d=t.closest("form").find('input[name="promocode"]').val(),""!==a?(t.closest("form").find('[name="ratecodes"]').val(a),$(window).width()<=1024&&(r.hasClass("active")||TweenLite.to(r,.75,{height:r.outerHeight(),ease:Power3.easeOut,onStart:function(){r.css({overflow:"hidden",height:"0"}).show()},onComplete:function(){r.addClass("active").removeAttr("style")}})),$("body").waveLoader({bars:8,overlay:!0,fixedHeight:!0}),$(".date-picker").each(function(){$(this).rateCalendar({months:4,startdate:new Date(moment(n).get("year"),moment(n).get("month"),moment(n).get("date")),enddate:new Date(moment(s).get("year"),moment(s).get("month"),moment(s).get("date")),currency:$(".currency-selector").val(),promocode:{value:d},ratecodes:{value:a,button:t}})})):alert("Cannot apply a code you haven't entered. Please enter a code and try again.")}break;case"iata":t.hasClass("disabled")?(t.closest("form").find('[name="iata"]').val(""),t.find(".button-content").text("Apply"),t.removeClass("disabled"),t.closest(".row").find('input[type="text"]').removeAttr("disabled").val("")):""!==a?(t.closest("form").find('[name="iata"]').val(a),t.removeClass("loading").addClass("state-success"),setTimeout(function(){t.find(".button-content").text("Remove"),t.removeClass("state-success").addClass("disabled"),t.closest(".row").find('input[type="text"]').attr("disabled","disabled")},750)):alert("Cannot apply a code you haven't entered. Please enter a code and try again.")}}),$("body").on("click","#cart-view .apply-code",function(e){e.preventDefault();var a=$(this),t=parseInt(a.closest(".cart-room").attr("data-cartid"),10),o=myCart.getRoom(t),r=myCart.getStayInfo(),n=a.closest(".row").find('input[type="text"]').val(),s=[],i=a.closest(".code-wrapper").attr("data-code-type");s.startdate=r.startdate,s.enddate=r.enddate,s.roomtype=o.rooms[0].roomId,s.rateplan=o.rooms[0].rateCode,s.promocode=o.rooms[0].promocode,s.adults=o.rooms[0].adults,s.children=o.rooms[0].children,s.iata=o.rooms[0].iata,s.id=o.rooms[0].cartId,"promocode"==i&&(a.hasClass("disabled")?s.promocode="":s.promocode=n),"iata"==i&&(a.hasClass("disabled")?s.iata="":s.iata=n);var d="/ajax/addroomtocart?startdate="+s.startdate+"&enddate="+s.enddate+"&roomtype="+s.roomtype+"&rateplan="+s.rateplan+"&adults="+s.adults+"&children="+s.children+"&id="+s.id;"object"!=typeof s.promocode&&""!==s.promocode&&(d+="&promocode="+s.promocode),"object"!=typeof s.iata&&""!==s.iata&&(d+="&iata="+s.iata),a.addClass("loading"),$.ajax({url:d,success:function(e){var t=e.data.errors.record;if(jQuery.isEmptyObject(e.data.errors)){e.data.data.record;myCart.getCartData().then(function(){var e=myCart.getCartView();a.removeClass("loading").addClass("state-success"),void 0!==e.stayInfo.startdate&&$("#cart-view").html(c(e)),$("body").hasClass("guest-information")&&($("#cart-view").find(".continue").hide(),"modifying"==e.cartState&&$("#cart-view").find(".buttons .column").html('<button class="button cancelling" href="/booking/guest-information?cancelling=true">Cancel Reservation</button>')),a.hasClass("disabled")?setTimeout(function(){a.find(".button-content").text("Apply"),a.removeClass("state-success").removeClass("disabled"),a.closest(".row").find('input[type="text"]').removeAttr("disabled")},2e3):setTimeout(function(){a.find(".button-content").text("Remove"),a.removeClass("state-success").addClass("disabled"),a.closest(".row").find('input[type="text"]').attr("disabled","disabled")},2e3),setTimeout(function(){a.closest(".add-promo-code").removeClass("active"),a.closest(".room-titles").find(".edit.active").removeClass("active")},1e3)})}else $("body").errorAlert({id:t["@attributes"].id,msg:t.message}),a.removeClass("loading").addClass("state-error"),setTimeout(function(){a.removeClass("state-error")},2e3)}})}),$(".rate-calendar-wrapper .currency-selector").on("change",function(e){e.preventDefault();var t=$(this),a=$(".search-form").find('input[name="startdate"]').val(),o=$(".search-form").find('input[name="enddate"]').val();$("body").waveLoader({bars:8,overlay:!0,fixedHeight:!0}),console.log(t.val()),$.when($.ajax({url:"/ajax/setcurrency?currency="+t.val()})).then(function(){console.log("triggered"),$(".date-picker").each(function(){$(this).rateCalendar({months:4,startdate:a,enddate:o,currency:t.val(),promocode:{value:$(".search-form").find('[name="promocode"]').val()}})}),t.closest(".outer-wrapper").find(".search-form input[name=currency]").val(t.val())})}),$("#cart").on("click",function(e){e.preventDefault();var t=$(this),a=myCart.getCartView();0<a.roomsInfo.rooms.length&&(t.hasClass("active")?(t.removeClass("active"),$("#cart-view").removeClass("active")):(void 0!==a.stayInfo.startdate&&$("#cart-view").html(c(a)),$("body").hasClass("guest-information")&&($("#cart-view").find(".continue").hide(),"modifying"==a.cartState&&$("#cart-view").find(".buttons .column").html('<button class="button cancelling" href="/booking/guest-information?cancelling=true">Cancel Reservation</button>')),t.addClass("active"),$("#cart-view").addClass("active")))}),$("#guest-information").on("change keyup keydown",'input[name="firstname"], input[name="lastname"]',function(){var e=$('#guest-information [name="firstname"]').val().toString()+" "+$('#guest-information [name="lastname"]').val().toString();$("#guest-information").find('input[name="cc_name"]').val(e)}),$("#guest-information").on("submit",function(e){e.preventDefault();var t=$(this).serialize();$("body").waveLoader({bars:8,overlay:!0,fixedHeight:!0}),myCart.getCartData().then(function(){var a=myCart.getCartView(),o=[];t+="&expectedtotal="+myCart.getSubtotal().grandtotalusd;var r=jQuery("<form>",{action:"/booking/confirmation/",method:"POST",name:"reservations:book-room"});$.each(a.roomsInfo.rooms,function(e,t){o.push({name:t.roomName,id:t.roomId,price:t.averageRate,brand:HOTELNAME,category:"Room",variant:t.rateCode,quantity:moment(a.stayInfo.enddate).diff(moment(a.stayInfo.startdate),"days").toString()}),$.isEmptyObject(t.packages.record)||(void 0===t.packages.record.length&&(t.packages.record=fixArray(t.packages.record)),$.each(t.packages.record,function(e,t){o.push({name:t.title,id:addon["@attributes"].code,price:addon["@attributes"].price,brand:HOTELNAME,category:"",quantity:addon["@attributes"].adults})}))}),"modifying"==a.cartState?$.when($.ajax({url:"/ajax/modifyuserdata?"+t})).then(function(){$.ajax({url:"",success:function(e){var t=e.data.errors.record;if(jQuery.isEmptyObject(e.data.errors)){var a=e.data.data.record;void 0===a.length&&(a=fixArray(a)),$.each(a,function(e,t){r.append(jQuery("<input>",{name:"confirmations["+e+"][confirmation]",value:t["@attributes"].confirmation,type:"hidden"})),r.append(jQuery("<input>",{name:"confirmations["+e+"][email]",value:t.email,type:"hidden"}))}),window.location.href=r.attr("action")+"?"+r.serialize()}else $("body").errorAlert({id:t["@attributes"].id,msg:t.message})}})}):$.ajax({url:"/ajax/bookrooms?"+t,success:function(e){var t=e.data.errors.record;if(jQuery.isEmptyObject(e.data.errors)){var a=e.data.data.record;void 0===a.length&&(a=fixArray(a)),$.each(a,function(e,t){r.append(jQuery("<input>",{name:"confirmations["+e+"][confirmation]",value:t["@attributes"].confirmation,type:"hidden"})),r.append(jQuery("<input>",{name:"confirmations["+e+"][email]",value:t.email,type:"hidden"}))}),window.location.href=r.attr("action")+"?"+r.serialize()}else $("body").errorAlert({errorslist:t}),$("body").find(".loading-overlay").remove()}})})}),$('[name="modify-cancel"]').on("submit",function(e){e.preventDefault();var a,t=$(this);$("body").waveLoader({bars:8,overlay:!0,fixedHeight:!1});var o="/ajax/initmodify?confirmation="+(a=t.serializeArray())[1].value+"&email="+a[0].value;$.ajax({url:o,dataType:"json"}).done(function(e){var t=e.data.errors.record;jQuery.isEmptyObject(e.data.errors)?e.data.data["@attributes"].modifyonline?window.location.href="/booking/guest-information?modifying=true&confirmation="+a[1].value+"&email="+a[0].value:(0<$("#icbe-lightbox").length?$("#icbe-lightbox").addClass("alert").find(".lightbox-content").html(s()):$("body").append('<div id="icbe-lightbox" class="alert"><div class="lightbox-content-wrapper"><div class="lightbox-content">'+s()+'</div><a class="close-button" href="#" title="Close Button"><span></span></a></div></div>'),$("#icbe-lightbox").addClass("active"),$("body").css("overflow","hidden").find(".loading-overlay").remove()):($("body").find(".loading-overlay").remove(),$("body").errorAlert({id:t["@attributes"].id,msg:t.message}))})}),$(".share").on("click",function(e){e.preventDefault();var t=$(this),a=t.width();t.hasClass("active")?(t.removeClass("active").removeAttr("style"),t.next("ul").removeClass("active"),t.html('<i class="plus">+</i>Share')):(t.addClass("active").attr("style","text-align: center; width: "+a+"px;"),t.next("ul").addClass("active"),t.html("CLOSE"))}),$(".share-email").on("click",function(e){e.preventDefault(),r=grecaptcha.render("share-recaptcha",{sitekey:"6LdOoCkTAAAAANU5IBoaGamkte0JNu6WvUB2qu5w",theme:"light"}),$("#icbe-lightbox").addClass("active")}),$(".submit-share").on("click",function(e){e.preventDefault();var a=$(this),t=a.closest("form"),o=[];a.addClass("loading"),t.parsley().isValid()&&""!==grecaptcha.getResponse(r)?($.each(t.serializeArray(),function(e,t){o[t.name]=t.value}),$.ajax({url:"/ajax/emailbookings?confirmations="+o.confirmations+"&toemail="+o.toemail+"&emails="+o.emails+"&g-recaptcha-response="+o["g-recaptcha-response"],dataType:"json"}).done(function(e){var t=e.data.errors.record;jQuery.isEmptyObject(e.data.errors)?(a.removeClass("loading").addClass("state-success"),setTimeout(function(){a.removeClass("state-success")},2e3)):(a.removeClass("loading").addClass("state-errors"),setTimeout(function(){a.removeClass("state-errors")},2e3),$("body").errorAlert({id:t["@attributes"].id,msg:t.message}))})):(t.parsley().validate(),a.removeClass("loading").addClass("state-error"),setTimeout(function(){a.removeClass("state-error")},2e3))}),$(".icbe-wrapper").on("click",".info-box-trigger",function(e){e.preventDefault();var t=$(this);t.hasClass("active")?(t.removeClass("active").text("i"),t.closest(".column").find(".flyout").removeClass("active")):(t.removeClass("active").text("×"),t.addClass("active"),t.closest(".column").find(".flyout").addClass("active"))}),$(".icbe-wrapper").on("click",".view-price-breakdown",function(e){e.preventDefault();var t=$(this);t.hasClass("active")?(t.removeClass("active"),t.next(".price-breakdown").removeClass("active")):(t.addClass("active"),t.next(".price-breakdown").addClass("active"))}),$("body").on("click",".floating-breakdown .close",function(e){e.preventDefault(),$(this).closest(".floating-breakdown").removeClass("active"),$(this).closest(".column").find(".view-price-breakdown").removeClass("active")}),$("body").on("click",".cancelling",function(e){e.preventDefault(),0<$("#icbe-lightbox").length?$("#icbe-lightbox").addClass("alert").find(".lightbox-content").html(confirmCancellation()):$("body").append('<div id="icbe-lightbox" class="alert"><div class="lightbox-content-wrapper"><div class="lightbox-content">'+confirmCancellation()+'</div><a class="close-button" href="#" title="Close Button"><span></span></a></div></div>'),$("#icbe-lightbox").addClass("active"),$("body").css("overflow","hidden")}),$("body").on("click",".confirm-cancellation",function(e){$("body").removeAttr("style").waveLoader({bars:8,overlay:!0,fixedHeight:!1}),$("html").removeAttr("style"),$("#icbe-lightbox").removeClass("active");var t=myCart.getCartView(),a="/ajax/cancelreservation?confirmation="+t.stayInfo.confirmation+"&email="+t.formdata.email;$.ajax({url:a,dataType:"json"}).done(function(e){var t=e.data.errors.record;jQuery.isEmptyObject(e.data.errors)?$.ajax({url:"/ajax/cancelmodify"}).done(function(){window.location.href="/booking"}):($("body").find(".loading-overlay").remove(),$("body").errorAlert({id:t["@attributes"].id,msg:t.message}))})}),$("body").on("click","#icbe-lightbox .close-button",function(e){e.preventDefault();$(this);var t=$(this).closest("#icbe-lightbox");t.removeClass("active"),!$("body").hasClass("confirmation")&&$(".confirmation-wrapper").length<1?t.find(".lightbox-content").html(""):(t.find("#share-recaptcha").html(""),t.find(".submit-share").removeClass("disabled").find(".button-content").text("Share"),t.find('input[name="toemail"]').val("")),$("body").removeAttr("style")}),$(window).on("orientationchange",function(){$("table").hide().show(0),window.dispatchEvent(new Event("resize"))}),$(window).on("resize",function(){setTimeout(function(){var e=$(".rate-calendar-wrapper");$(window).width()<=1024?$(".search-form").has(".rate-calendar-wrapper")||$(".search-form .fields-wrapper > .column:nth-child(2)").append(e):$(".search-form").has(".rate-calendar-wrapper")&&$(".outer-wrapper").append(e),$(".rooms-grid").each(function(){$(this).roomWrapperAdjust()})},100),setTimeout(function(){$(".events-wrapper").buildEvents(eventData)},250)})}),$.fn.rateCalendar=function(e){var t=new Date;new Date(t).setDate(t.getDate()+1);var s,i,d,c,o,a={months:8,showMonths:2,promocode:{value:"",button:void 0},ratecodes:{value:"",button:void 0},roomtype:"",currency:"USD"},l=$.extend({},a,e),m=$(this),r=sabreDateFormat(t),u=[],p=[],f=[],v=!0;return this.each(function(){if(u[0]="Jan",u[1]="Feb",u[2]="Mar",u[3]="Apr",u[4]="May",u[5]="Jun",u[6]="Jul",u[7]="Aug",u[8]="Sep",u[9]="Oct",u[10]="Nov",u[11]="Dec",moment(moment(calState).date(1)).isBefore(moment(t).date(1).add(4,"months"))&&moment(calState).date(1).format("YYYY-MM-DD")!==moment(t).date(1).format("YYYY-MM-DD")&&!l.startdate?c=moment(r).date(1):(c=l.startdate&&moment(l.startdate).format("YYYY-MM-DD")!==moment(t).format("YYYY-MM-DD")?moment(l.startdate).date(1):moment(r).format("YYYY-MM")===moment(calState).format("YYYY-MM")?moment(r).date(1):moment(calState).date(1),0<moment(calState).diff(moment(l.startdate))&&moment(c).subtract(1,"month")),i=moment(c),d=moment(c).add(Math.floor(l.months-1),"months"),i=moment(i).date(1),d=moment(d).date(1),urlParams="?startdate="+moment(c).format("YYYY-MM-DD")+"&months="+l.months+"&currency="+l.currency,""!==l.promocode.value&&void 0!==l.promocode.value&&(urlParams=urlParams+"&promocode="+l.promocode.value),""!==l.ratecodes.value&&void 0!==l.ratecodes.value){var e=l.ratecodes.value.split(",");$.each(e,function(e,t){urlParams=urlParams+"&ratecodes["+e+"]="+t})}l.roomtype&&(urlParams+="&roomtypes[0]="+l.roomtype),void 0!==l.promocode.button&&(o=l.promocode.button),void 0!==l.ratecodes.button&&(o=l.ratecodes.button),void 0!==o&&(!o.hasClass("apply-code")||""===l.promocode.value&&""===l.ratecodes.value||o.addClass("loading")),$.when(y(urlParams)).then(function(){$.when(function n(e){var t=e.data;if(t.data.record&&t["@attributes"].success){ratesJSON=t.data.record,void 0!==l.promocode.button&&($("body").find(".loading-overlay").remove(),o.removeClass("loading").addClass("state-success"),""!==l.promocode.value?(o.closest("form").find('[name="promocode"]').val(l.promocode.value),setTimeout(function(){o.find(".button-content").text("Remove"),o.removeClass("state-success").addClass("disabled"),o.closest(".row").find('input[type="text"]').attr("disabled","disabled")},2e3)):(o.closest("form").find('[name="promocode"]').val(""),setTimeout(function(){o.closest(".row").find('input[type="text"]').removeAttr("disabled").val(""),o.find(".button-content").text("Apply"),o.removeClass("disabled").removeClass("state-success")},2e3))),void 0!==l.ratecodes.button&&($("body").find(".loading-overlay").remove(),o.removeClass("loading").addClass("state-success"),""!==l.ratecodes.value?(o.closest("form").find('[name="ratecodes"]').val(l.ratecodes.value),setTimeout(function(){o.find(".button-content").text("Remove"),o.removeClass("state-success").addClass("disabled"),o.closest(".row").find('input[type="text"]').attr("disabled","disabled")},2e3)):(o.closest("form").find('[name="ratecodes"]').val(""),setTimeout(function(){o.closest(".row").find('input[type="text"]').removeAttr("disabled").val(""),o.find(".button-content").text("Apply"),o.removeClass("disabled").removeClass("state-success")},2e3))),a=ratesJSON,jQuery.isEmptyObject(a)||a.forEach(function(e,t){p[e.date]=e.amountbeforetax,1<parseInt(e.minstay,10)&&1===parseInt(e.bestday,10)&&"Close"!==e.status?f[e.date]={status:"Best Min",minstay:e.minstay,checkout:Number(e.checkout)}:1===parseInt(e.bestday,10)&&"Close"!==e.status?f[e.date]={status:"Best Day",minstay:e.minstay,checkout:Number(e.checkout)}:1<parseInt(e.minstay,10)?f[e.date]={status:"Min Stay",minstay:e.minstay,checkout:Number(e.checkout)}:f[e.date]={status:e.status,minstay:e.minstay,checkout:Number(e.checkout)}}),m.datepick("destroy"),m.datepick({rangeSelect:!0,monthsToShow:l.showMonths,useMouseWheel:!1,changeMonth:!1,todayText:"",minDate:new Date,maxDate:$.datepick.determineDate("+12m",new Date),prevText:'<i class="fa fa-angle-left"></i>',nextText:'<i class="fa fa-angle-right"></i>',renderer:$.extend({},$.datepick.defaultRenderer,{picker:$.datepick.defaultRenderer.picker.replace(/\{link:today\}/,""),month:'<div class="datepick-month"><div class="datepick-month-header">{monthHeader:MM yyyy}</div><table><thead>{weekHeader}</thead><tbody>{weeks}</tbody></table></div>'}),onShow:function(e){e.attr("style","")},onChangeMonthYear:function(e,t){var a=new Date(e,Math.floor(t-1),1);if(calState=moment(a),!v){var o=moment(a).add(1,"months"),r=moment(a).subtract(1,"months");moment(a).diff(moment(c))<0&&moment(a).diff(moment(i))<0?void 0===f[r.format("YYYY-MM-DD")]&&(urlParams="?startdate="+moment(a).subtract(l.months,"months").format("YYYY-MM-DD")+"&months="+Math.ceil(l.months+1)+"&currency="+l.currency,i=moment(a).subtract(l.months,"months").format("YYYY-MM-DD"),v=!0,""!==l.promocode.value&&void 0!==l.promocode.value&&(urlParams=urlParams+"&promocode="+l.promocode.value),""!==l.ratecodes.value&&void 0!==l.ratecodes.value&&(urlParams=urlParams+"&ratecodes="+l.ratecodes.value),l.roomtype&&(urlParams+="&roomtypes[0]="+l.roomtype),$("body").waveLoader({bars:8,overlay:!0,fixedHeight:!0}),$.when(y(urlParams)).then(function(){$.when(n(s)).then(function(){m.datepick("setDate",new Date(sabreDateFormat(m.closest(".outer-wrapper").find('input[name="startdate"]').val())),new Date(sabreDateFormat(m.closest(".outer-wrapper").find('input[name="enddate"]').val()))),m.datepick("showMonth",e,t),v=!1})})):0<=moment(a).diff(moment(c))&&0<=moment(a).diff(moment(d))&&void 0===f[o.format("YYYY-MM-DD")]&&(urlParams="?startdate="+moment(a).format("YYYY-MM-DD")+"&months="+Math.ceil(l.months+1)+"&currency="+l.currency,d=moment(a).format("YYYY-MM-DD"),v=!0,""!==l.promocode.value&&void 0!==l.promocode.value&&(urlParams=urlParams+"&promocode="+l.promocode.value),""!==l.ratecodes.value&&void 0!==l.ratecodes.value&&(urlParams=urlParams+"&ratecodes="+l.ratecodes.value),l.roomtype&&(urlParams+="&roomtypes[0]="+l.roomtype),$("body").waveLoader({bars:8,overlay:!0,fixedHeight:!0}),$.when(y(urlParams)).then(function(){$.when(n(s)).then(function(){m.datepick("setDate",new Date(sabreDateFormat(m.closest(".outer-wrapper").find('input[name="startdate"]').val())),new Date(sabreDateFormat(m.closest(".outer-wrapper").find('input[name="enddate"]').val()))),m.datepick("showMonth",e,t),v=!1})}))}},onSelect:function(e){var t=new Date(e[0]),a=new Date(e[1]);if(0<e.length)if(m.closest(".outer-wrapper").find(".check-in .selected-date").html('<span class="month">'+u[t.getMonth()]+'</span><span class="day">'+t.getDate()+"</span>"),m.closest(".outer-wrapper").find('input[name="startdate"]').val(t.getFullYear()+"-"+("00"+(t.getMonth()+1)).slice(-2).toString()+"-"+("00"+t.getDate()).slice(-2).toString()),t.valueOf()<a.valueOf()){m.closest(".outer-wrapper").find(".check-out .selected-date").html('<span class="month">'+u[a.getMonth()]+'</span><span class="day">'+a.getDate()+"</span>"),m.closest(".outer-wrapper").find('input[name="enddate"]').val(a.getFullYear()+"-"+("00"+(a.getMonth()+1)).slice(-2).toString()+"-"+("00"+a.getDate()).slice(-2).toString());for(var o=Math.round((a.valueOf()-t.valueOf())/864e5),r=moment(t.valueOf()),n=moment(a.valueOf()),s=0,i=!1,d=0;d<o;d++){0!==d&&r.add(1,"days");var c=f[r.format("YYYY-MM-DD")];if("Close"===c.status){i=!0;break}if(1<c.minstay){s=c.minstay;break}}1===f[n.format("YYYY-MM-DD")].checkout&&(i=!1),i?($("body").errorAlert({msg:"One or more of your nights are not available. Please try again.",lightbox:!0}),m.closest(".outer-wrapper").find('input[type="submit"]').attr("disabled","disabled")):s&&o<s&&($("body").find(".alert-box").removeClass("shown"),m.closest(".outer-wrapper").find('input[type="submit"]').removeAttr("disabled"),setTimeout(function(){$("body").find(".alert-box:not(.shown)").remove()},750)),s&&o<s?($("body").errorAlert({msg:"This stay requires a minimum of "+s+" nights.",lightbox:!0}),m.closest(".outer-wrapper").find('input[type="submit"]').attr("disabled","disabled")):i||($("body").find(".alert-box").removeClass("shown"),m.closest(".outer-wrapper").find('input[type="submit"]').removeAttr("disabled"),setTimeout(function(){$("body").find(".alert-box:not(.shown)").remove()},750))}else m.closest(".outer-wrapper").find('input[type="submit"]').attr("disabled","disabled")},onDate:function(e,t){var a=sabreDateFormat(e),o="",r={},n=p[a];if(t){if(void 0!==p[a]&&""===l.promocode.value&&(o='<div class="cal-lowest-rates"><span class="currency">from '+l.currency+'</span><span class="rate">'+n.split(".").shift()+"</span></div>"),f[a])switch(f[a].status){case"Best Min":r={content:e.getDate()+o,dateClass:"best-min"};break;case"Best Day":r={content:e.getDate()+o,dateClass:"best-day"};break;case"Min Stay":r={content:e.getDate()+o,dateClass:"min-stay"};break;case"Close":r={dateClass:"not-avail"};break;default:r={content:e.getDate()+o,dateClass:"avail"}}}else dateClass={dateClass:""};return r}})}else $("body").errorAlert({msg:t.errors.record.message,lightbox:!0}),$("body").find(".loading-overlay").remove(),o.removeClass("loading").addClass("state-error"),void 0!==l.promocode.button&&o.closest("form").find('[name="promocode"]').val(""),void 0!==l.ratecodes.button&&o.closest("form").find('[name="ratecodes"]').val(""),setTimeout(function(){o.find(".button-content").text("Apply"),o.removeClass("disabled").removeClass("state-error")},2e3);var a;$("body").find(".loading-overlay").remove()}(s)).then(function(){l.startdate&&l.enddate?(m.datepick("setDate",moment(l.startdate).format("MM/DD/YYYY"),moment(l.enddate).format("MM/DD/YYYY")),0<moment(calState).diff(moment(l.startdate))?m.datepick("showMonth",moment(l.startdate).year(),Math.ceil(moment(l.startdate).month()+2)):m.datepick("showMonth",moment(l.startdate).year(),moment(l.startdate).month()+1)):m.datepick("showMonth",moment(calState).year(),Math.ceil(moment(calState).month()+1)),v=!1})})});function y(e,t){var a=void 0!==t&&t;return $.Deferred(function(t){availabilityRequest=$.ajax({type:"GET",url:"/ajax/rate-calendar"+e,cache:a,success:function(e){s=e,$("body").find(".loading-overlay").remove(),t.resolve()}}).error(function(e){console.log("failed!"),console.log(e.status),$("body").find(".loading-overlay").remove(),$("body").errorAlert({msg:e.status}),t.resolve()})})}},$.fn.populateForm=function(a){return this.each(function(){var e=$(this);for(var t in a.formdata)"object"!=typeof a.formdata[t]&&e.find('[name="'+t+'"]').val(a.formdata[t])})},$.fn.loadEvents=function(e){return this.each(function(){var a=$(this);$.ajax({url:"/ajax/recentevents?number=4",dataType:"json"}).done(function(e){var t=e.data.errors.record;eventData=e.data.data.content.record,jQuery.isEmptyObject(e.data.errors)?a.buildEvents(eventData):$("body").errorAlert({id:t["@attributes"].id,msg:t.message})})})},$.fn.buildEvents=function(t){return this.each(function(){var a=[],o=[],e=$(this);$.isEmptyObject(t)?e.find(".events").html(noEventsTemplate()):(void 0===t.length&&(t=fixArray(t)),void 0!==t.length?$.each(t,function(e,t){(o=[]).formattedStart=moment(t.dates.record["@attributes"].startdate).format("MMMM DD"),o.formattedEnd=moment(t.dates.record["@attributes"].enddate).format("MMMM DD"),o.title=t.title,o.filename=t.file["@attributes"].id+"/14/"+t.file.filename,o.formattedStart==o.formattedEnd&&(o.sameDate=!0),a.push(o)}):((o=[]).formattedStart=moment(ev.dates.record["@attributes"].startdate).format("MMMM DD"),o.formattedEnd=moment(ev.dates.record["@attributes"].enddate).format("MMMM DD"),o.title=t.title,o.filename=t.file["@attributes"].id+"/14/"+t.file.filename,o.formattedStart==o.formattedEnd&&(o.sameDate=!0),a.push(o)),$(window).width()<=1024?e.find(".events").html(eventsMTemplate(a)):e.find(".events").html(eventsLTemplate(a)))})};