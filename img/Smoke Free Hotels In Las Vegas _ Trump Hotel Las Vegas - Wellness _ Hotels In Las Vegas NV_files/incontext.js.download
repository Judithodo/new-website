"use strict";function productClick(e,t,a,n){}function makeParams(e){var t="?";for(var a in e)e[a]&&(t+=a+"="+e[a]+"&");return t.substring(0,t.length-1)}function iOSfix(e){if($("html").hasClass("touch")||"touch"===$("body").attr("data-whatinput")){var t=$("body");t.addClass("icbe-open icbe-type-"+e),$(".icbe-is-open").on("focus","input, select",function(e){t.addClass("icbe-fixfixed")}).on("blur","input, select",function(e){t.removeClass("icbe-fixfixed")})}}function onlyUnique(e,t,a){return a.indexOf(e)===t}var today=new Date,tomorrow=new Date(today),userChangedMonthYear=!1,calState=moment(today),minStartRate="",HOTELNAME=$("body").data("property"),SYNXISID=$("body").data("synxisid"),LANGUAGEID=$("body").data("lang"),CURRENCY="USD",statusLookup=[],availabilityRequest;!function(e,t){if(t.sabre=t.sabre||{},t.sabre.ICBE=t.sabre.ICBE||{},!e(".offers-listing").length){var a={};!function(){e.when(e.ajax("/templates/main/js/templates/incontext.html")).then(function(t){var n=e(t);Handlebars.registerPartial("currencySelector",n.filter("#currency-selector").html()),a.bookingSteps=n.filter("#booking-steps").html(),a.yourStay=Handlebars.compile(n.filter("#step-your-stay").html()),a.notFound=Handlebars.compile(n.filter("#not-found").html()),a.ratesStep=n.filter("#step-rates").html(),a.ratesListings=Handlebars.compile(n.filter("#rates-listings").html()),a.roomUpgrade=Handlebars.compile(n.filter("#room-upgrade").html()),a.addonStep=n.filter("#step-addons").html(),a.addonListings=Handlebars.compile(n.filter("#addon-listings").html()),a.cartView=Handlebars.compile(n.filter("#cart").html()),a.guestInfoForm=n.filter("#guest-information-form").html(),a.confirmation=Handlebars.compile(n.filter("#confirmation").html()),a.emailShare=Handlebars.compile(n.filter("#email-share").html()),Handlebars.registerHelper("getHotelId",function(){return SYNXISID}),Handlebars.registerHelper("getPrice",function(e,t){var a=parseFloat(e).toFixed(2),n=["0","00"];return n=(""+a).split("."),"dollars"===t?n[0]:"cents"===t?n[1]:isNaN(a)?"0.00":a}),Handlebars.registerHelper("dateFormatStr",function(e,t){return moment(new Date(convertDateStr(e,"/"))).format(t)}),Handlebars.registerHelper("timeFormatStr",function(e,t,a){return moment(e,t).format(a)}),Handlebars.registerHelper("getCurrencyCode",function(){return sabre.ICBE.myCart.getCurrency()}),Handlebars.registerHelper("getAddonType",function(e,t){var a=e.toLowerCase().replace("per ","");return a=a.replace(" per ","/"),"uppercase"===t?a.toUpperCase():a.replace(" per ","/").toLowerCase()}),Handlebars.registerHelper("toLowerCase",function(e){if("string"==typeof e)return e.toLowerCase()}),Handlebars.registerHelper("toUpperCase",function(e){if("string"==typeof e)return e.toUpperCase()}),Handlebars.registerHelper("if_string_eq",function(e,t,a){return e.toLowerCase()===t.toLowerCase()?a.fn(this):a.inverse(this)}),Handlebars.registerHelper("quantity_select",function(e){var t="";if(t="<select>",isFinite(e))for(var a=1;a<=e;a++)t+='<option value="'+a+'">'+a+"</option>";return t+="</select>",new Handlebars.SafeString(t)}),Handlebars.registerHelper("to_secure",function(e){return e.replace("http://","https://")}),Handlebars.registerHelper("to_secure_convert_spaces",function(e){return e.replace(/ /g,"%20").replace("http://","https://")}),Handlebars.registerHelper("pluralize",function(e,t){var a={guest:"guests",child:"children",adult:"adults",room:"rooms"},n="";return t=t.toLowerCase(),n=1!=+e?a[t]:t,e+" "+n.charAt(0).toUpperCase()+n.slice(1)}),Handlebars.registerHelper("formatCurrency",function(e,t,a,n){return t||(t=i.getCurrency()),"boolean"!=typeof a&&(a=!1),"boolean"!=typeof n&&(n=!1),formatCurrency(e,t,a,n)}),Handlebars.registerHelper("isNotEmptyObject",function(t,a){e.isEmptyObject(t)||a.fn(this)})},function(e){console.error(e)})}();var n=t.sabre.bookingApi=function(){var t={addPackage:"/ajax/addpackagetocart",addRoom:"/ajax/addroomtocart",bookRooms:"/ajax/bookrooms",clearCart:"/ajax/clearcart",getAvailability:"/ajax/availability",getAddons:"/ajax/getaddons",getCartData:"/ajax/getcartdata",getReservations:"/ajax/getreservations",rateCalendar:"/ajax/rate-calendar",removeRoom:"/ajax/removeroomfromcart",removePackage:"/ajax/removepackagefromcart",setCurrency:"/ajax/setcurrency",getRoomTypes:"/ajax/getroomtypespage"},a={};for(var n in t)a[n]=function(a){return function(n,r,o){return n=n||"",o=o||{},r?e[r](t[a]+n,o):e.ajax(t[a]+n,o)}}(n);return a}(),r=t.sabre.ICBE.events=function(){var e=function(e,t){return r.channels[e]||(r.channels[e]=[]),r.channels[e].push({context:this,callback:t}),this},t=function(e){if(!r.channels[e])return!1;for(var t=Array.prototype.slice.call(arguments,1),a=0,n=r.channels[e].length;a<n;a++){var o=r.channels[e][a];o.callback.apply(o.context,t)}return this};return{channels:{},publish:t,subscribe:e,installTo:function(a){a.subscribe=e,a.publish=t}}}(),o=t.sabre.ICBE=function(){function t(e){console.error("ICBE: "+e)}var a,n,p,f=0,h="",g={},b=!1;r.installTo(g),g.subscribe("ready",function(n){if(a=e(n),!a.length)return t("there is no "+n+" on this page!");e.when(i.ajaxClearCart()).then(i.ajaxGetCartData)}),g.subscribe("searchStepReady",function(t,r){CURRENCY=r||CURRENCY,h!==t&&(f=0,h=t,n=e("<div/>",{id:"step-wrapper"}),p=e("<div/>",{id:"cart-wrapper"}),a.empty().append(n,p),s.start(a),i.start(p,a.find("#cart")),i.ajaxClearCart(),i.ajaxSetCurrency(CURRENCY).promise().done(function(){e.when(i.ajaxGetCartData()).then(i.updateCart),"function"==typeof fn&&fn()}),d.start(n,t,CURRENCY)),s.makeActive(f)}),g.subscribe("resetICBE",function(){h="";var t=o.getRoomId(),a=CURRENCY;e(".media-gallery.show").length&&(t=e(".galleria-expand").attr("data-roomid"),a=e(".galleria-expand").attr("data-currency")),g.publish("searchStepReady",t,a)}),g.subscribe("currencyChanged",function(t,a){i.ajaxSetCurrency(t).promise().done(function(){CURRENCY=t,e.when(i.ajaxGetCartData()).then(i.updateCart),"function"==typeof a&&a()})});var v=function(e){e=e||{step:0},f=e.step,s.startOver(f),i.ajaxGetCartData().then(i.updateCart)};g.subscribe("promoCodeAdded",v),g.subscribe("promoCodeRemoved",v),g.subscribe("searchStepCompleted",function(e){s.complete(f),f=1,s.makeActive(f).startOver(f),i.ajaxClearCart().then(i.updateCart),n.children().detach(),i.ajaxGetCartData().then(c.start(n,e))}),g.subscribe("stepBackFromRates",function(){w(0)}),g.subscribe("rateAdded",function(){i.ajaxGetCartData().then(function(){i.updateCart();var e=i.getAttributes(),t=i.getRooms().rooms,a={hotel_id:SYNXISID,startdate:e.startdate,enddate:e.enddate,currency:e.currency,adults:t[0].adults,children:t[0].children,rateplan:t[0].rateCode};setTimeout(function(){s.complete(f),f=2,s.makeActive(f),n.children().detach(),l.start(n,a)},1500)})}),g.subscribe("rateRemoved",v.bind(g,{step:1})),g.subscribe("addonAdded",function(){i.ajaxGetCartData().then(function(){i.updateCart(),l.updateSelected(i.getPackages())})}),g.subscribe("addonRemoved",function(){i.ajaxGetCartData().then(function(){i.updateCart(),l.updateSelected(i.getPackages())})});var y=function(){n.children().detach(),u.start(n,i.getCurrentTotalUSD()),s.complete(f),f=3,s.makeActive(f),dataLayer.push({event:"reservation-review",SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/reservation-review","gtm.blacklist":["fsl","cl","tl","jel","hl"]})};g.subscribe("addonStepCompleted",y),g.subscribe("readyToBook",y),g.subscribe("bookingSuccess",function(t){m.start(a,t,function(){a.empty(),e("body").find(".loading-overlay").remove()})});var w=function(e){switch(f=e,s.makeActive(f),n.children().detach(),e){case 0:d.showCached(n);break;case 1:c.showCached(n);break;case 2:l.showCached(n)}};return g.subscribe("stepChanged",function(e){w(e)}),g.subscribe("editStay",function(){w(0)}),g.subscribe("editRate",function(){w(1)}),g.subscribe("editPackage",function(){w(2)}),g.show=function(){b=!0,TweenLite.fromTo(a,.35,{opacity:.4},{opacity:1,ease:Quint.easeOut,onStart:function(){a.css("display","block")},onComplete:function(){window.scrollTo(0,getScrollPos())}})},g.hide=function(){b=!1,TweenLite.to(a,.35,{height:0,ease:Quint.easeOut,onStart:function(){a.css("overflow","hidden")},onComplete:function(){a.removeAttr("style").css("display","none")}})},g.isOpen=function(){return b},g.getParent=function(){return a},g.getRoomId=function(){return h},g.setCurrentRoomId=function(e){h=e},g}(),i=o.myCart=function(t){function r(){return n.getCartData().done(function(t){successful(t)&&(f=t.data.data,h=t.data.data,g=!0,b=!e.isEmptyObject(f.rooms))})}function i(){var e={};for(var t in f["@attributes"])e[t]=f["@attributes"][t];return e}function s(){var t=JSON.parse(JSON.stringify(h)),a=isArray(t.rooms.record)?t.rooms.record:[t.rooms.record];return{"@attributes":i(),rooms:e.map(a,function(t){return{roomNum:+t["@attributes"].id+1,roomName:t.name,adults:+t["@attributes"].adults,children:+t["@attributes"].children,promocode:e.isEmptyObject(t.promocode)?"":t.promocode,packages:isArray(t.packages.record)?t.packages.record:[t.packages.record],cartId:+t["@attributes"].id,roomId:t["@attributes"].roomcode,rateCode:t["@attributes"].ratecode,rateName:t.rate.name,rateInfo:t.rate,dailyRates:isArray(t.rate.days.record)?t.rate.days.record:[t.rate.days.record],price:{subtotal:(+t["@attributes"].subtotal).toFixed(2),fees:(+t["@attributes"].fees).toFixed(2),taxes:(+t["@attributes"].taxes).toFixed(2)}}})}}function d(t,a){t.on("click",c),a.on("click",".edit-stay",function(a){a.preventDefault(),c.call(t),o.publish("editStay"),e(".promocode-trigger").click()}),a.on("click",".edit-rate",function(e){e.preventDefault(),c.call(t),o.publish("editRate")}),a.on("click",".edit-package",function(e){e.preventDefault(),c.call(t),o.publish("editPackage")}),a.on("click",".view-price-breakdown, .price-breakdown .close",function(t){t.preventDefault(),e(this).parents(".column").find(".price-breakdown").toggleClass("active")}),a.on("click",".continue",function(e){e.preventDefault(),c.call(t),o.publish("readyToBook")}),a.on("mouseenter",".has-tip",function(t){var a=e(this),n=a.closest(".icbe-wrapper"),r=n.offset().top,o=a.offset().top,i=a.attr("data-toggle");e("#"+i).css({position:"fixed","z-index":"20",top:o-r+"px","max-width":"20rem"})})}function c(t){if(t&&t.preventDefault(),!b)return!1;e(this).toggleClass("active"),g&&(f=l(),p.html(a.cartView(f)),e(document).foundation(),g=!1),p.toggleClass("active")}function l(){var t={rooms:0,packages:0,fees:0,taxes:0,total:0},a=i(),n=s(),r=0,o=0,d=[],c=new Date(convertDateStr(a.startdate,"/")),l=new Date(convertDateStr(a.enddate,"/"));return e.each(n.rooms,function(a,i){if(t.rooms+=+i.price.subtotal,t.fees+=+i.price.fees,t.taxes+=+i.price.taxes,t.packages=i.packages[0]?e.map(i.packages,function(e){return+e["@attributes"].total}).reduce(function(e,t){return e+t},0):0,i.averageRate=+(+i.price.subtotal/((l-c)/864e5)).toFixed(2),e.each(i.dailyRates,function(e,t){t&&d.push({date:t["@attributes"].date,price:+t["@attributes"].price})}),r+=+i.adults,o+=+i.children,i.packages[0]&&(i.hasPackages=!0),i.promocode&&(i.hasPromo=!0),a===n.rooms.length-1)for(var s in t)t[s]=(+t[s]).toFixed(2)}),t.byDayBreakdown=[],e.each(d,function(a,n){var r=!1;e.each(t.byDayBreakdown,function(e,t){if(t.date===n.date)return r=!0,t.price+=+n.price,t.price=parseFloat(t.price).toFixed(2),!1}),r||t.byDayBreakdown.push({date:n.date,price:parseFloat(n.price).toFixed(2)})}),a.totalAdults=r,a.totalChildren=o,a.totalRooms=n.rooms.length,n.stayInfo=a,n.subtotal=t,n}var u,m,p,f={},h={},g=!1,b=!1;return{start:function(e,t){p=e,m=t,u=m.find(".total"),d(m,p)},ajaxClearCart:function(){return e.when(n.clearCart()).then(r)},ajaxGetCartData:function(){return e.when(r())},ajaxSetCurrency:function(t){return e.when(n.setCurrency("?currency="+t))},getAttributes:function(){return i()},getCurrency:function(){return i().currency},getCurrentTotal:function(){return i().grandtotal},getCurrentTotalUSD:function(){return i().grandtotalusd},getPackages:function(){return e.map(s().rooms,function(e){return e.packages})},getRooms:function(){return s()},updateCart:function(){var e=t(parseFloat(f["@attributes"].grandtotal).toFixed(2),i().currency);e.match(/[a-zA-Z]/)?u.siblings(".title").css("display","none"):window.innerWidth>1025&&u.siblings(".title").css("display","inline-block"),u.text(e),b?m.find(".open-close-icon").css("display","block"):m.find(".open-close-icon").css("display","none")}}}(formatCurrency),s=function(){function t(t){n.find(".step a").on("click",function(a){a.preventDefault();var n=e(this).parents(".step");if("cart"===this.id||n.hasClass("active"))return!1;if(!n.hasClass("completed")&&!n.hasClass("started"))return e(".icbe-wrapper").errorAlert({msg:"Please complete the current step before proceeding. "}),!1;var r=t.index(n);o.publish("stepChanged",r)})}var n,r;return{start:function(e){return e.find(".booking-steps").length||(e.prepend(a.bookingSteps),n=e.find(".booking-steps"),r=n.find(".step"),t(r)),this},makeActive:function(e){var t=r.eq(e);return r.removeClass("active"),t.addClass("active"),t.hasClass("completed")||t.addClass("started"),this},complete:function(e){return r.eq(e).removeClass("started").addClass("completed"),this},startOver:function(e){r.removeClass("started").eq(e).addClass("started").removeClass("completed");for(var t=0;t<r.length;t++)t>e&&r.eq(t).removeClass("completed");return this}}}(),d=function(){function t(t){function a(){window.innerWidth<=1025?u.has(l).length||u.append(l):u.has(l)&&t.append(l)}var r=t.find(".search-form"),i=t.find(".date-picker"),s=o.getRoomId(),d={$promo:r.find('input[name="promocode"][type="hidden"]'),$group:r.find('input[name="ratecodes"][type="hidden"]')};void 0!==s&&(s=s.split(","),s=s.filter(onlyUnique),s.length>1?(t.find(".big-dropdowns").show(),t.removeClass("one-room"),t.find('[name="roomtype"]').closest(".columns").removeClass("hide"),e.when(n.getRoomTypes(makeParams({hotel_id:SYNXISID}))).done(function(a){if(a.success){var n=(s[0],a.records);void 0===n.length&&(n=fixArray(n)),e.each(n,function(e,a){s.indexOf(a.synxisid)>=0&&t.find('[name="roomtype"]').append('<option value="'+a.synxisid+'" data-roomprice="'+a.minrate+'">'+a.roomname+"</option>")}),o.setCurrentRoomId(minStartRate),t.find('[name="roomtype"] option:eq(0)').remove(),t.find('[name="roomtype"] option[value="'+minStartRate+'"]').attr("selected","selected"),t.find('[name="roomtype"]').removeAttr("disabled")}else e(".icbe-wrapper").errorAlert({msg:"Sorry, something went wrong. Please try again."})}).fail(function(){e(".icbe-wrapper").errorAlert({msg:"Sorry, something went wrong. Please try again."})})):(t.find(".big-dropdowns").hide(),t.addClass("one-room"))),t.find('[name="roomtype"]').on("change",function(){var a=e(this),n=a.val(),r=a.find(":selected");if(""!==n){o.setCurrentRoomId(n),e(".icbe-wrapper").waveLoader({fixedHeight:!1});var s={roomtype:o.getRoomId(),currency:t.find(".currency-selector").val(),startdate:t.find('input[name="startdate"]').val(),enddate:t.find('input[name="enddate"]').val(),adults:t.find('select[name="adults"]').val(),whenLoaded:function(){e("body").find(".loading-overlay").remove()},whenFailed:function(){e("body").find(".loading-overlay").remove()}};i.rateCalendar(s);productClick(window.location.pathname.split("/"),r.text(),n,r.data("roomprice"))}}),t.find('[name="adults"]').on("change",function(){var a=e(this),n=a.val();if(""!==n){e(".icbe-wrapper").waveLoader({fixedHeight:!1});var r={roomtype:o.getRoomId(),currency:t.find(".currency-selector").val(),startdate:t.find('input[name="startdate"]').val(),enddate:t.find('input[name="enddate"]').val(),adults:n,whenLoaded:function(){e("body").find(".loading-overlay").remove()},whenFailed:function(){e("body").find(".loading-overlay").remove()}};i.rateCalendar(r)}}),t.find(".promo-codes").on("click","a",function(t){t.preventDefault();var a=e(this),n=a.closest("label"),r=a.closest(".promo-codes"),o=a.attr("data-code-type"),i=new TimelineLite;a.hasClass("active")||(n.find("a").removeClass("active"),a.addClass("active"),i.fromTo(r.find(".code-wrapper.active"),.25,{opacity:1,scale:1},{opacity:0,scale:.8,clearProps:"transform",ease:Back.easeIn,onComplete:function(){r.find(".code-wrapper.active").removeClass("active")}}).fromTo(r.find(".code-wrapper[data-code-type="+o+"]"),.25,{opacity:0,scale:.9},{opacity:1,scale:1,clearProps:"transform",ease:Back.easeOut,onStart:function(){r.find(".code-wrapper[data-code-type="+o+"]").addClass("active")}}))}),t.find(".code-wrapper").on("click",".apply-code:not(.remove-code)",function(a){a.preventDefault();var n=e(this),s=n.closest(".code-wrapper").find('input[type="text"]'),c=s.attr("name"),l=s.val();if(!l)return e(".icbe-wrapper").errorAlert({msg:"Cannot apply a code you haven't entered. Please enter a code and try again."}),!1;if("promocode"===c||"group"===c){e(".icbe-wrapper").waveLoader({fixedHeight:!1});var u={roomtype:o.getRoomId(),currency:t.find(".currency-selector").val(),startdate:t.find('input[name="startdate"]').val(),enddate:t.find('input[name="enddate"]').val(),adults:t.find('select[name="adults"]').val(),whenLoading:function(){n.animateButton({action:"loading"})},whenLoaded:function(){e("body").find(".loading-overlay").remove(),"promocode"===c?d.$promo.val(l):d.$group.val(l),n.animateButton({action:"animateSuccess"}),o.publish("promoCodeAdded")},whenFailed:function(){e("body").find(".loading-overlay").remove(),n.animateButton({action:"failed"})}};"promocode"===c?u.promocode=l:u.ratecode=l,i.rateCalendar(u)}else"iata"===c&&(r.prepend(e("<input/>",{name:"agencyid",value:l,type:"hidden"})),n.animateButton({action:"success"}))}),t.find(".code-wrapper").on("click",".remove-code",function(a){a.preventDefault();var n=e(this),r=n.attr("data-code-type"),s=r;"group"===r&&(s="ratecodes"),t.find('input[type="hidden"][name="'+s+'"]').val(""),n.animateButton({action:"removeCode"});var c={currency:t.find(".currency-selector").val(),startdate:t.find('input[name="startdate"]').val(),enddate:t.find('input[name="enddate"]').val(),adults:t.find('select[name="adults"]').val(),whenLoaded:function(){e("body").find(".loading-overlay").remove(),n.animateButton({action:"default"}),o.publish("promoCodeRemoved")}};"promocode"!==r&&"group"!==r||(d.$promo.val()&&(c.promocode=d.$promo.val()),d.$group.val()&&(c.ratecode=d.$group.val()),n.animateButton({action:"loading"}),e(".icbe-wrapper").waveLoader({fixedHeight:!1}),i.rateCalendar(c))}),t.find("form").on("submit",function(t){t.preventDefault();var a=new Date,n=r.find('input[name="startdate"]').val(),i=r.find('input[name="enddate"]').val(),s=new Date(convertDateStr(n,"/")),d=new Date(convertDateStr(i,"/"));if(moment(s).isSameOrAfter(moment(a))<d&&d>a){var c=r.find('select[name="adults"]').val(),l=r.find('select[name="children"]').val(),u=r.find('input[type="hidden"][name="promocode"]').val(),m=r.find('input[type="hidden"][name="agencyid"]').val(),p=r.find(".currency-selector").val();p=e(".currency-wrapper .currency-selector").val(),o.publish("searchStepCompleted",{startdate:n,enddate:i,adults:c,children:l,promocode:u,iata:m,currency:p})}else e(".icbe-wrapper").errorAlert({msg:"Please verify your check-in and check-out dates and try again."})}),t.find(".currency-selector").on("change",function(){var t=e(this).val(),a=r.find('input[name="startdate"]').val(),n=r.find('input[name="enddate"]').val(),s=r.find('select[name="adults"]').val();e(".icbe-wrapper").waveLoader({fixedHeight:!1}),o.publish("currencyChanged",t,function(){var c={hotel_id:SYNXISID,currency:t,roomtype:o.getRoomId(),startdate:a,enddate:n,adults:s,whenLoaded:function(){e("body").find(".loading-overlay").remove()}};d.$promo.val()&&(c.promocode=d.$promo.val()),d.$group.val()&&(c.ratecode=d.$group.val()),e(".selected-date").empty(),r.find('input[name="currency"]').val(t),i.rateCalendar(c)})}),t.find(".promocode-trigger").on("click",function(t){t.preventDefault(),e(this).parent(".promocode-field").toggleClass("promocode-is-open"),e(this).parent(".promocode-field").hasClass("promocode-is-open")?e(this).text("Close"):e(this).text("Add a Code")}),e(window).on("orientationchange",function(){t.find(".datepick-month").hide().show(0)});var c;e(window).on("resize",function(){clearTimeout(c),c=setTimeout(a,100)});var l=t.find(".rate-calendar-wrapper"),u=r.find(".check-in-out-column");a()}var r;return{start:function(e,n,o){e.empty().append(a.yourStay),r=e.find(".your-stay"),"USD"!==o&&r.find(".currency-selector").val(o),t(r),r.find(".date-picker").rateCalendar({currency:o,roomtype:minStartRate})},showCached:function(e){r&&e.append(r)}}}(),c=function(){function t(t,a,n){var r=!1;if(e.isEmptyObject(t))return rates;var o=isArray(t.record)?t.record:[t.record];e.each(o,function(t,o){if(r)return!1;var i=o.rooms.record;i=isArray(i)?i:[i],e.each(i,function(t,o){if(r)return!1;var i=a.split(",");e.each(i,function(e){o["@attributes"].roomid===i[e]&&(r=!0,n(o))})})})}function r(a,n){var r=[],o={event:"detailView",ecommerce:{detail:{products:[]}}},i=[];return e.isEmptyObject(a)?r:(t(a,n,function(t){r=isArray(t.rates.record)?t.rates.record:[t.rates.record],e.each(r,function(e,t){t["@attributes"].totalprice=(parseFloat(t["@attributes"].totalfees)+parseFloat(t["@attributes"].totaltaxes)+parseFloat(t["@attributes"].totalrate)).toFixed(2),t.dailyrates.record=isArray(t.dailyrates.record)?t.dailyrates.record:[t.dailyrates.record],i.push({name:t.name,id:t["@attributes"].ratecode,price:t["@attributes"].averagerate,brand:HOTELNAME,category:"Rate"})})}),o.ecommerce.detail.products=i,r)}function i(e,a){var n="";return t(e,a,function(e){n=e["@attributes"].upgraderoomid}),n}function s(a,n,r){var o={};return t(a,n,function(t){if("unassigned"===t.group.name.toLowerCase())return!1;o.isRoomUpgrade=!0;var a=isArray(t.rates.record)?t.rates.record:[t.rates.record];e.each(a,function(e,t){t.dailyrates.record=isArray(t.dailyrates.record)?t.dailyrates.record:[t.dailyrates.record]}),o.lowestrate=a.sort(d)[0],o.lowestrate["@attributes"].totalprice=(parseFloat(o.lowestrate["@attributes"].totalfees)+parseFloat(o.lowestrate["@attributes"].totaltaxes)+parseFloat(o.lowestrate["@attributes"].totalrate)).toFixed(2),o.roomname=t.name,o.roomid=t["@attributes"].roomid,o.image=t.image,o.group={id:t.group["@attributes"].id,name:t.group.name},o.pricedifference=(parseFloat(o.lowestrate["@attributes"].totalrate)-parseFloat(r[0]["@attributes"].totalrate)).toFixed(2)}),o}function d(e,t){return e["@attributes"].averagerate-t["@attributes"].averagerate}function c(a){var r=a.find(".rates-listings");r.find(" > .column > ul > li").length>2&&r.find(" > .column > ul").slick({slidesToShow:1,mobileFirst:!0,responsive:[{breakpoint:800,settings:{slidesToShow:2,infinite:!1,swipe:!1}},{breakpoint:1100,settings:{slidesToShow:3,infinite:!1,swipe:!1}}],appendArrows:r}),r.find(".view-breakdown").on("click",function(t){t.preventDefault(),e(this).parents("li").find(".price-breakdown").slideToggle(150)}),r.find(".price-breakdown .close").on("click",function(t){t.preventDefault(),e(this).parents(".price-breakdown").slideToggle(150)}),r.find(".description > .column").each(function(){e(this).wrapInner('<div class="desc-body" />');var t=e(this).find("h3"),a=e(this).find(".terms"),n=e(this).find(".desc-body");a.insertAfter(n),t.insertBefore(n).wrap('<div class="heading-wrap" />')}),r.find(".see-all-roomtype").on("click",function(e){e.preventDefault()});var i=!1,s=!1;r.find(".select-rate").on("click",function(a){if(a.preventDefault(),i)return!1;var d,c,m,p=e(this),h=p.attr("data-rate"),g=p.attr("data-roomid"),b=p.attr("data-rate"),v=p.attr("data-rate-price"),y={defaultText:"Select",removeClass:"selected",removeText:"Selected"},w=[];y.action="loading",p.animateButton(y),i=!0,t(f,g||o.getRoomId(),function(e){e["@attributes"].roomid===(g||o.getRoomId())&&(w={currency:e["@attributes"].currency,name:e.name,id:e["@attributes"].roomid,price:v,brand:HOTELNAME,category:"Room",variant:b,quantity:moment(u.enddate).diff(moment(u.startdate),"days").toString()})}),p.hasClass("selected")?(d=n.removeRoom,c="?id=0",m=!1):(d=n.addRoom,c=makeParams(u),c+="&hotel_id="+SYNXISID,c+="&rateplan="+h,c+="&roomtype="+(g||o.getRoomId()),s&&(c+="&id=0"),m=!0),e.when(d(c)).done(function(e){if(successful(e))return m?(y.action="default",r.find(".select-rate.selected").animateButton(y),y.action="animateSuccess",p.animateButton(y),o.publish("rateAdded"),s=!0):(y.action="default",p.animateButton(y),o.publish("rateRemoved"),s=!1),!0;y.action="failed",p.animateButton(y),l(e)}).always(function(){i=!1}).fail(function(){y.action="failed",p.animateButton(y),l()})})}function l(t){t&&"10007"===t.data.errors.record["@attributes"].id&&e(".icbe-wrapper").errorAlert({msg:"Sorry, we were unable to add this rate with your selected dates and guests."}),e(".icbe-wrapper").errorAlert({msg:"Sorry, something went wrong with adding this rate. Please try again."})}var u,m,p=[],f=[];return{start:function(t,l){t.append(a.ratesStep),u=l,m=t.find(".rates-step"),u.hotel_id=SYNXISID,dataLayer.push({SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",SynxisArrivalSearch:moment(u.startdate).format("MM/DD/YYYY"),SynxisDepartureSearch:moment(u.enddate).format("MM/DD/YYYY"),SynxisArrivalSearchYYYYMMDD:moment(u.startdate).format("YYYY-MM-DD"),SynxisDepartureSearchYYYYMMDD:moment(u.enddate).format("YYYY-MM-DD"),event:"availability-results",BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/availability-results","gtm.blacklist":["fsl","cl","tl","jel","hl"]}),e.when(n.getAvailability(makeParams(u))).done(function(t){var n=t.data.data.availability;f=n;var l="",u={};p=r(n,o.getRoomId()).sort(d),l=i(n,o.getRoomId()),l&&(u=s(n,l,p)),p.length?(o.publish("ratesUpdated",{rates:p,bestrate:p[0]}),m.find(".rates-listings .column").html(a.ratesListings(p)).promise().done(function(){if(!e.isEmptyObject(u)){var t=m.find(".cards .card");t.length>=3?t.eq(1).after(a.roomUpgrade(u)):(t.last().after(a.roomUpgrade(u)),t.removeClass("end"),m.find(".room-upgrade").addClass("end"))}c(m)})):(m.html(a.notFound({message:'Sorry, there are no rates available for your <span class="pink">selected date</span> and <span class="pink">guests</span>. Please try your <a href="#" class="step-back">search</a> again.'})),m.find(".step-back").on("click",function(e){e.preventDefault(),o.publish("stepBackFromRates")}))}).fail(function(){m.html(a.notFound({message:'Sorry, an error has occurred. Please <a href="#" class="step-back">go back</a> to try again.'})),m.find(".step-back").on("click",function(e){e.preventDefault(),o.publish("stepBackFromRates")})})},showCached:function(e){if(m){e.append(m);var t=m.find(".rates-listings .cards");t.hasClass("slick-initialized")&&t.slick("setPosition")}}}}(),l=function(){function t(t){var a=isArray(t)?t:[t],n=1;moment(_searchData.startdate).format("MM/DD/YYYY"),moment(_searchData.enddate).format("MM/DD/YYYY");return e.map(a,function(e){var t=[];return void 0===e&&(e={}),isArray(e.record)?(t=e.record[0],t["@attributes"].needsdate=!0):t=void 0!==e.record?e.record:[],void 0!==t["@attributes"]&&""!=t["@attributes"].increment&&(t["@attributes"].needstime=!0),void 0!==t["@attributes"]&&("true"===t["@attributes"].countpeople||t["@attributes"].needsdate||t["@attributes"].needstime)&&(t["@attributes"].needsform=!0),n++,t})}function r(t){var a=[],n=p[t];return e.each(u,function(e,t){-1!==n.indexOf(t.category)&&a.push(t)}),a}function s(t){var a="";return m[0]&&e.each(m,function(e,n){if(n["@attributes"].code===t)return a=n["@attributes"].id,!1}),a}function d(t){var i=t.find(".addon-listings");t.find(".addon-menu").find(".fancy-selector").css("display","block"),i.find("ul").slick({slidesToShow:1,mobileFirst:!0,responsive:[{breakpoint:800,settings:{slidesToShow:2,infinite:!1,swipe:!1}},{breakpoint:1024,settings:{slidesToShow:3,infinite:!1,swipe:!1}}],appendArrows:i});var d=new Date(convertDateStr(_searchData.startdate,"/")),l=new Date(convertDateStr(_searchData.enddate,"/"));i.find(".date-begin").pickadate({format:"mm/dd/yyyy",formatSubmit:"yyyy-mm-dd",today:"",clear:"",min:[d.getFullYear(),d.getMonth(),d.getDate()],max:[l.getFullYear(),l.getMonth(),l.getDate()],container:e(document.body),onClose:function(){e(document.activeElement).blur()}});moment(_searchData.startdate+" "+i.find(".timepicker").data("increment")).format("m");i.find(".timepicker").pickatime({formatSubmit:"HH:i:00",interval:15,min:[0,0],max:void 0,container:e(document.body)}),i.find(".addon-description > .column").each(function(){e(this).wrapInner('<div class="desc-body" />');var t=e(this).find("h3"),a=e(this).find(".desc-body");t.insertBefore(a).wrap('<div class="heading-wrap" />'),iOSfix("addons")}),t.find('select[name="addon-filters"]').on("change",function(){var t=i.find(".column"),n=e(this).val();if(t.find("ul.cards").slick("unslick"),i.find(".date-begin").each(function(){e(this).pickadate("picker").stop()}),t.empty(),"all"===n)t.html(a.addonListings(u));else{var o=r(n);o.length?t.html(a.addonListings(o)):t.html(a.notFound({message:"Sorry, there are no available add ons for this category."}))}i.find(".cards").slick({slidesToShow:1,mobileFirst:!0,responsive:[{breakpoint:800,settings:{slidesToShow:2,infinite:!1,swipe:!1}},{breakpoint:1024,settings:{slidesToShow:3,infinite:!1,swipe:!1}}],appendArrows:i}),i.find(".date-begin").pickadate({format:"mm/dd/yyyy",formatSubmit:"yyyy-mm-dd",today:"",clear:"",min:[d.getFullYear(),d.getMonth(),d.getDate()],max:[l.getFullYear(),l.getMonth(),l.getDate()],container:e(document.body),onClose:function(){e(document.activeElement).blur()}});var s=moment(_searchData.startdate+" "+i.find(".timepicker").data("increment")).format("m");i.find(".timepicker").pickatime({formatSubmit:"HH:i:00",interval:s,min:[0,0],max:void 0,container:e(document.body)}),m.length&&e.each(m,function(e,a){var n=t.find('.select-button[data-addon-code="'+a["@attributes"].code+'"]');if(!n.length)return!1;n.addClass("selected").find(".button-content").text("Selected");var r=n.closest(".card"),o=r.find(".date-begin"),i=r.find(".fancy-selector select");if(i.length&&i.val(a["@attributes"].adults),o.length){o.pickadate("picker").set("select",new Date(convertDateStr(a["@attributes"].startdate,"/")))}})}),i.on("click",".select-addon",function(t){t.preventDefault();var a=e(this);if(a.hasClass("disabled"))return!1;var r=a.parents("li"),i=r.find('.addon-info input[name="date_submit"]'),d=r.find('.addon-info input[name="time_submit"]'),l=a.attr("data-addon-code"),u=r.find(".addon-info select").val(),m=i.val(),p=d.val();r.find(".addon-description h3").text(),a.attr("data-price"),r.attr("data-addon-category");if(i.length&&!m)return e(".icbe-wrapper").errorAlert({msg:"Please enter a date before selecting this add on."}),!1;if(d.length&&!p)return e(".icbe-wrapper").errorAlert({msg:"Please enter a time before selecting this add on."}),!1;var f,h={defaultText:"Select",removeClass:"selected",removeText:"Selected"},g="?roomid=0",b=!0;a.hasClass("selected")?(f=n.removePackage,g+="&packageid="+s(l),b=!1):(f=n.addPackage,g+="&hotel_id="+_searchData.hotel_id,g+="&roomtype="+_searchData.roomId,g+="&currency="+_searchData.currency,g+="&startdate="+(m||_searchData.startdate),g+="&enddate="+(m||_searchData.enddate),g+="&adults="+(u||_searchData.adults),g+="&children="+(u?0:_searchData.children),g+="&packagecode="+l,g+="&rateplan="+_searchData.rateplan,g+="&increment="+p,setTimeout(e(".addon-menu .continue").text("Continue"),2e3)),h.action="loading",a.animateButton(h),e.when(f(g)).done(function(e){if(successful(e))return b?(h.action="animateSuccess",a.animateButton(h),o.publish("addonAdded")):(h.action="default",a.animateButton(h),o.publish("addonRemoved")),!1;h.action="failed",a.animateButton(h),c(e)}).fail(function(){h.action="failed",a.animateButton(h),c()})}),e(".addon-step .continue").on("click",function(t){t.preventDefault(),e(".booking-steps #cart").click(),o.publish("addonStepCompleted")})}function c(t){t&&"10012"===t.data.errors.record["@attributes"].id&&e(".icbe-wrapper").errorAlert({msg:"Sorry, this add on is not available."}),e(".icbe-wrapper").errorAlert({msg:"Sorry, something went wrong with selecting this add on. Please try again."})}
var l,u=[],m=[],p={guarantee:["Hotel Guarantees"],dining:["Dining Offers"],spa:[],transportation:["TRANSPORTATION"],nightlife:["FLY BEYOND WITH LUXURY GREY GOOSE EXPERIENCES"],enhanced:[]};return{updateSelected:function(e){m=e},start:function(r,o){r.append(a.addonStep),l=r.find(".addon-step"),_searchData=o,_searchData.hotel_id=SYNXISID;var s=(i.getAttributes(),i.getRooms().rooms);_searchData.roomId=s[0].roomId,dataLayer.push({event:"add-ons",SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/add-ons","gtm.blacklist":["fsl","cl","tl","jel","hl"]}),e.when(n.getAddons(makeParams(_searchData))).done(function(n){successful(n)&&(u=t(n.data.data.record),u.length?(l.find(".addon-listings .column").html(a.addonListings(u)),d(l)):(l.find(".addon-listings .column").html(a.notFound({message:"Sorry, there are no add ons for your selected room and dates."})),d(l),e(".addon-heading .continue").click()))})},showCached:function(e){l&&(e.append(l),l.find(".addon-listings ul").slick("setPosition"))}}}(),u=function(){function t(t){var a=t.find("form.guest-info-form");a.parsley(),a.prepend('<input name="hotel_id" type="hidden" value="'+SYNXISID+'" />'),a.on("submit",function(t){if(t.preventDefault(),e(".header-wrapper, .booking-console-wrapper").removeAttr("style"),u)return!1;e(".icbe-wrapper").waveLoader({bars:8,fixedHeight:!1}),d(a);var o=i.getAttributes(),c=i.getRooms().rooms,l=[];e.each(c,function(t,a){var n=moment(o.enddate).diff(moment(o.startdate),"days"),r=Number(a.price.subtotal)/n;l.push({name:a.roomName,id:a.roomId,price:r,brand:HOTELNAME,category:"Room",variant:a.rateCode,quantity:n.toString()}),void 0!==a.packages[0]&&e.each(a.packages,function(e,t){l.push({name:t.title,id:t["@attributes"].code,price:t["@attributes"].price,brand:HOTELNAME,category:t.category,quantity:t["@attributes"].adults.toString()})})}),e.when(n.bookRooms("","post",a.serialize())).done(function(e){r(e)}).fail(s)})}function r(t){if(!successful(t))return s(),!1;var a=t.data.data.record,n=[];isArray(a)||(a=[a]),e.each(a,function(e,t){n.push({confirmation:t["@attributes"].confirmation,email:t.email})}),o.publish("bookingSuccess",n),u=!0}function s(){e("body").errorAlert({msg:"Sorry, something went wrong with finalizing your booking. Please check the required fields and try again. "}).find(".loading-overlay").remove()}function d(e){var t=e.find("#firstName").val()+" "+e.find("#lastName").val();e.find("#expectedtotal").length?e.find("#expectedtotal").val(l):e.append('<input id="expectedtotal" type="hidden" name="expectedtotal" value="'+l+'"/>'),e.find("#cc_name").length?e.find("#cc_name").val(t):e.append('<input id="#cc_name" type="hidden" name="cc_name" value="'+t+'"/>')}var c,l=0,u=!1;return{start:function(n,r){var o={event:"customer-information",SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/customer-information","gtm.blacklist":["fsl","cl","tl","jel","hl"]};dataLayer.push(o);var s=i.getAttributes(),d=i.getRooms().rooms,m=[];e.each(d,function(t,a){var n=moment(s.enddate).diff(moment(s.startdate),"days"),r=Number(a.price.subtotal)/n;m.push({name:a.roomName,id:a.roomId,price:r,brand:HOTELNAME,category:"Room",variant:a.rateCode,quantity:n.toString()}),void 0!==a.packages[0]&&e.each(a.packages,function(e,t){m.push({name:t.title,id:t["@attributes"].code,price:t["@attributes"].price,brand:HOTELNAME,category:t.category,quantity:t["@attributes"].adults.toString()})})}),n.append(a.guestInfoForm),c=n.find(".guest-info-wrapper"),l=r,u=!1,t(c)},showCached:function(e,t){e.append(c),l=t}}}(),m=function(){function t(e){for(var t="",a=0;a<e.length;a++)t+=0===a?"?":"&",t+="hotel_id="+SYNXISID,t+="&confirmations["+a+"][confirmation]="+e[a].confirmation,t+="&confirmations["+a+"][email]="+e[a].email;return t}function r(t){var a=t.record;if(!e.isEmptyObject(a.packages.record)&&!isArray(a.packages.record)){var n=0;a.packages.record=[a.packages.record],e.each(a.packages.record,function(e,t){n+=+t["@attributes"].total}),a["@attributes"].packagetotal=n}return a.rate.days.record=isArray(a.rate.days.record)?a.rate.days.record:[a.rate.days.record],t}function i(t){t.find(".print").on("click",function(e){e.preventDefault(),window.print()}),t.find(".share").on("click",function(t){t.preventDefault();var a=e(this);a.hasClass("active")?(a.html('<i class="plus">+</i>Share'),a.removeClass("active"),a.parents("li").find(".flyout").removeClass("active")):(a.addClass("active"),a.html("×"),a.parents("li").find(".flyout").addClass("active"))}),t.find(".view-price-breakdown, .price-breakdown .close").on("click",function(t){t.preventDefault(),e(this).parents(".column").find(".price-breakdown").toggleClass("active")}),t.find(".info-box-trigger").on("click",function(t){t.preventDefault();var a=e(this);a.hasClass("active")?(a.removeClass("active").text("i"),a.closest(".column").find(".flyout").removeClass("active")):(a.removeClass("active").text("×"),a.addClass("active"),a.closest(".column").find(".flyout").addClass("active"))}),t.find(".share-email").on("click",function(t){t.preventDefault(),e("#icbe-lightbox").addClass("active")});var a=!1;e("body").on("submit","#icbe-lightbox form",function(t){if(t.preventDefault(),a)return!1;var n=e(this),r=n.find(".submit-share"),o=e("#confirmations_confirmation, #confirmations_email").map(function(){return e(this).attr("name")+"="+e(this).val()}).get().join("&"),i=n.find('input[name="toemail"]').val().split(",");if(r.addClass("loading").find(".button-progress fa").addClass("fa-cog fa-spin"),n.parsley().isValid()){i=e.map(i,function(e){return e.trim()});var d=[],c={success:0,fails:0};e.each(i,function(t,a){d.push(e.ajax({url:"/ajax/emailbookings?"+o+"&toemail="+a+"&hotel_id="+SYNXISID+"&languageid="+LANGUAGEID,dataType:"json",success:function(t){var a=t.data.errors.record;jQuery.isEmptyObject(t.data.errors)?c.success++:(c.fails++,e(".icbe-wrapper").errorAlert({id:a["@attributes"].id,msg:a.message}))},error:function(){c.fails++,s()}}))}),a=!0,e.when.apply(void 0,d).always(function(){r.removeClass("loading").find(".button-progress fa").removeClass("fa-cog fa-spin"),a=!1,c.success===i.length?(r.addClass("state-success"),setTimeout(function(){r.removeClass("state-success")},2e3)):(r.addClass("state-errors"),setTimeout(function(){r.removeClass("state-errors")},2e3))})}else n.parsley().validate(),r.removeClass("loading").addClass("state-error"),setTimeout(function(){r.removeClass("state-error")},2e3)}),e("body").on("click","#icbe-lightbox .close-button",function(t){t.preventDefault();var a=e(this).closest("#icbe-lightbox");a.removeClass("active"),a.find(".submit-share").removeClass("disabled").find(".button-content").text("Share"),a.find('input[name="toemail"]').val(""),e("body").removeAttr("style")}),e(".confirmation-details").foundation(),e(".confirmation-details").on("mouseenter",".has-tip",function(t){var a=e(this),n=a.closest(".icbe-wrapper"),r=n.offset().top,o=a.offset().top,i=a.attr("data-toggle");e("#"+i).css({position:"fixed","z-index":"20",top:o-r+"px","max-width":"20rem"})})}function s(){e(".icbe-wrapper").errorAlert({msg:"Sorry, something went wrong with emailing your reservation. Please try again."})}return{start:function(s,d,c){e.when(n.getReservations(t(d))).done(function(t){if("function"==typeof c&&c(),successful(t)){var n=r(t.data.data);o.publish("reservationRetrieved",n);var d=n.record["@attributes"].startdate,l=n.record["@attributes"].enddate,u=moment(d).diff(moment(new Date),"days").toString(),m=Math.floor(9e15*Math.random())+1e15,p=[],f=0,h=0,g=moment(l).diff(moment(d),"days"),b=(n["@attributes"].grandtotalusd,0),v="",y=isArray(n.record)?n.record:[n.record];e.each(y,function(t,a){f+=a["@attributes"].taxes,p.push({sku:SYNXISID+" - "+a["@attributes"].roomcode+" - "+a["@attributes"].ratecode,name:a.name,category:"Room",price:a["@attributes"].rate,quantity:moment(l).diff(moment(d),"days").toString()}),v=a.name,h++,b+=a["@attributes"].subtotal,e.isEmptyObject(a.packages.record)||e.each(a.packages.record,function(e,t){p.push({sku:SYNXISID+" - "+t["@attributes"].code,name:t.name,price:t["@attributes"].price,category:t.category,quantity:t["@attributes"].quantity})})}),dataLayer.push({event:"booking-confirmation",SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",SynxisDaystoArrival:u.toString(),SynxisArrivalSearch:moment(d).format("MM/DD/YYYY"),SynxisDepartureSearch:moment(l).format("MM/DD/YYYY"),BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/booking-confirmation",transactionId:SYNXISID+" - "+HOTELNAME+" - "+m.toString()+" - icbe",transactionRoomQty:h.toString(),transactionNightsQty:g.toString(),transactionAffiliation:HOTELNAME,transactionTotal:n["@attributes"].grandtotal,transactionCurrency:n["@attributes"].currency,transactionRateName:n.record.rate.name,transactionRateCode:n.record.rate["@attributes"].code,transactionDailyRate:n.record["@attributes"].rate,transactionRateQty:1,transactionRoomName:v,transactionProducts:p,rtADR:b/g,"gtm.blacklist":["fsl","cl","tl","jel","hl"]}),e("body").append(a.emailShare(n)),n.record.hotel=HOTELNAME,n.record.hotelURL=window.location.origin+"/"+window.location.pathname.split("/")[1],s.append(a.confirmation(n)).promise().done(function(){i(s.find(".confirmation-wrapper"))})}})}}}()}}(jQuery,window),$(function(){var e=sabre.ICBE,t=$(".interior-body");if(window.innerWidth>=768||"mouse"===$("body").attr("data-whatinput")){e.publish("ready","#icbe");e.getParent();t.find(".roomtyperates-button").on("focus click",function(t){if(t.preventDefault(),window.innerWidth<768)return window.location.href=this.href,!1;$(".icbe-wrapper");$(".bookingconsole").hasClass("bookingconsole-is-open icbe-is-open")||(TweenMax.from(".bookingconsole",.3,{opacity:0}),$("body").addClass("noscroll")),$(".bookingconsole").addClass("bookingconsole-is-open icbe-is-open").addClass("short").removeClass("full"),iOSfix("room"),Foundation.MediaQuery.atLeast("large");var a=$(this),n=(a.hasClass("active"),a.attr("data-roomid"));minStartRate=a.attr("data-minratecode");var r=a.attr("data-currency"),o=a.attr("data-roomname"),i=a.attr("data-roomprice");productClick(window.location.pathname.split("/"),o,minStartRate,i),dataLayer.push({SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/check-availability",event:"check-availability","gtm.blacklist":["fsl","cl","tl","jel","hl"]}),e.publish("searchStepReady",n,r)}),$(".minigallery-rooms").on("focus click",function(t){console.log("test"),t.preventDefault();$(".icbe-wrapper");$(".bookingconsole").hasClass("bookingconsole-is-open icbe-is-open")||(TweenMax.from(".bookingconsole",.3,{opacity:0}),$("body").addClass("noscroll")),$(".bookingconsole").addClass("bookingconsole-is-open icbe-is-open").addClass("short").removeClass("full"),iOSfix("mini"),Foundation.MediaQuery.atLeast("large");var a=$(this),n=(a.hasClass("active"),a.attr("data-roomid")),r=a.attr("data-currency"),o=a.attr("data-minratecode"),i=a.attr("data-roomname"),s=a.attr("data-roomprice");productClick(window.location.pathname.split("/"),i,o,s),dataLayer.push({SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/check-availability",event:"check-availability","gtm.blacklist":["fsl","cl","tl","jel","hl"]}),e.publish("searchStepReady",n,r)}),$("body").off("click",'.galleria-expand[data-type="room"]'),$("body").on("click",'.galleria-expand[data-type="room"]',function(t){if(t.preventDefault(),window.innerWidth<768)return window.location.href=this.href,!1;$(".icbe-wrapper");if($(".bookingconsole").hasClass("bookingconsole-is-open icbe-is-open"))TweenMax.to(".bookingconsole",.5,{opacity:0,onComplete:function(){$(".bookingconsole").removeClass("bookingconsole-is-open icbe-is-open icbe-gallery"),$(".bookingconsole").attr("style",""),$("body").removeClass("noscroll"),e.publish("resetICBE")}});else{$(".bookingconsole").addClass("bookingconsole-is-open icbe-is-open icbe-gallery").addClass("short").removeClass("full"),TweenMax.from(".bookingconsole",.5,{delay:.5,opacity:0}),$("body").addClass("noscroll"),iOSfix("gallery"),Foundation.MediaQuery.atLeast("large")&&2;var a=$(this),n=(a.hasClass("active"),a.attr("data-roomid")),r=a.attr("data-roomname"),o=a.attr("data-roomprice"),i=a.attr("data-currency");productClick(window.location.pathname.split("/"),r,n,o),dataLayer.push({SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/check-availability",event:"check-availability","gtm.blacklist":["fsl","cl","tl","jel","hl"]}),e.publish("searchStepReady",n,i)}}),$("body").on("click touchstart",".galleria-image",function(){e.publish("resetICBE")}),$(".bookingconsole > .close").on("click",function(){$(this).parent().hasClass("icbe-is-open")&&!$("body").hasClass("icbe-type-offer")&&($("body").removeClass("icbe-open icbe-type-room icbe-type-mini icbe-type-gallery icbe-type-undefined"),e.publish("resetICBE"))})}if($("html").hasClass("touch")){var a=$("body");$(document).on("focus","select",function(e){a.addClass("fixfixed")}).on("blur","select",function(e){a.removeClass("fixfixed")})}}),$.fn.toggleText=function(){return this.each(function(){var e=$(this),t=e.text();e.text(e.attr("data-toggle-text")).attr("data-toggle-text",t)})},$.fn.animateButton=function(e){var t={defaultText:"Apply",removeClass:"remove-code",removeText:"remove",disabledText:""},a=$.extend({},t,e);return this.each(function(){var e=$(this),t=a.$input||e.closest(".code-wrapper").find('input[type="text"]'),n=a.$content||e.find(".button-content");"removeCode"===a.action&&(e.removeClass(a.removeClass),t.removeAttr("disabled").val(""),n.text(a.defaultText)),"loading"===a.action&&(e.addClass("loading disabled"),t.attr("disabled","disabled"),n.text(a.disabledText)),"default"===a.action&&(e.removeClass("loading state-error disabled "+a.removeClass),t.removeAttr("disabled"),n.text(a.defaultText)),"success"===a.action&&(e.addClass(a.removeClass),t.attr("disabled","disabled"),n.text(a.removeText)),"animateSuccess"===a.action&&TweenLite.to(e.find(".progress-inner"),.1,{height:e.height(),ease:Linear.easeNone,onComplete:function(){e.removeClass("loading disabled").addClass("state-success"),e.find(".progress-inner").css({height:"0%",opacity:"0"}),setTimeout(function(){e.removeClass("state-success").addClass(a.removeClass),n.text(a.removeText),t.attr("disabled","disabled")},1500)}}),"failed"===a.action&&TweenLite.to(e.find(".progress-inner"),0,{height:e.height(),ease:Linear.easeNone,onComplete:function(){e.addClass("state-error").delay(.1).removeClass("loading"),e.find(".progress-inner").css({height:"0%",opacity:"0"}),setTimeout(function(){a.action="default",e.animateButton(a)},3e3)}},.2)})},$.fn.rateCalendar=function(e){var t,a,n,r,o={months:6,promocode:"",ratecode:"",roomType:"",startDate:new Date,currency:"USD",roomtype:"",adults:1,whenLoaded:function(){},whenLoading:function(){},whenFailed:function(){}},i=$.extend({},o,e),s=!0;return this.each(function(){function e(e,t){for(var a=0;a<t.length;a++)e[t[a].date]={},e[t[a].date].rate=61172===SYNXISID?t[a].amountaftertax:t[a].amountbeforetax,g.push({closed:"Close"===t[a].status,date:t[a].date}),+t[a].minstay>1&&1==+t[a].bestday&&"Close"!==t[a].status?e[t[a].date].status="Best Min":1==+t[a].bestday?e[t[a].date].status="Best Day":+t[a].minstay>1?e[t[a].date].status="Min Stay":e[t[a].date].status=t[a].status,e[t[a].date].minstay=t[a].minstay,e[t[a].date].checkout=Number(t[a].checkout);return e}function o(){for(var e="",t=0,a=g.length;t<a;t++)if(!g[t].closed){e=g[t].date;break}return e}function d(e,a){var n=void 0!==a&&a;return $.Deferred(function(a){availabilityRequest=$.ajax({type:"GET",url:"/ajax/rate-calendar"+e,cache:n,success:function(e){t=e,$("body").find(".loading-overlay").remove(),a.resolve()}}).error(function(e){console.log("failed!"),$("body").find(".loading-overlay").remove(),$("body").errorAlert({msg:e.status}),a.resolve()})})}function c(e){jQuery.isEmptyObject(e)||e.forEach(function(e,t){g.push({closed:"Close"===e.status,date:e.date}),h[e.date]=e.amountbeforetax,parseInt(e.minstay,10)>1&&1===parseInt(e.bestday,10)&&"Close"!==e.status?statusLookup[e.date]={status:"Best Min",minstay:e.minstay,checkout:Number(e.checkout)}:1===parseInt(e.bestday,10)&&"Close"!==e.status?statusLookup[e.date]={status:"Best Day",minstay:e.minstay,checkout:Number(e.checkout)}:parseInt(e.minstay,10)>1?statusLookup[e.date]={status:"Min Stay",minstay:e.minstay,checkout:Number(e.checkout)}:statusLookup[e.date]={status:e.status,minstay:e.minstay,checkout:Number(e.checkout)}})}function l(m){if(successful(m)){var h=m.data.data.record,g=1;f=e(f,h),Foundation.MediaQuery.atLeast("large")&&(g=2),c(h),u.datepick("destroy"),u.datepick({rangeSelect:!0,monthsToShow:g,useMouseWheel:!1,changeMonth:!1,todayText:"",minDate:new Date,maxDate:$.datepick.determineDate("+12m -1d",new Date),prevText:'<svg class="svg-cal-arrow" xmlns="http://www.w3.org/2000/svg" width="13" height="25" viewBox="0 0 13.661 25"><path d="M13.66 12.49L1.217 0 0 .302 12.153 12.5 0 24.698 1.216 25 13.66 12.51l-.04-.01"/></svg>',nextText:'<svg class="svg-cal-arrow" xmlns="http://www.w3.org/2000/svg" width="13" height="25" viewBox="0 0 13.661 25"><path d="M13.66 12.49L1.217 0 0 .302 12.153 12.5 0 24.698 1.216 25 13.66 12.51l-.04-.01"/></svg>',renderer:$.extend({},$.datepick.defaultRenderer,{picker:$.datepick.defaultRenderer.picker.replace(/\{link:today\}/,""),month:'<div class="datepick-month"><div class="datepick-month-header">{monthHeader:MM yyyy}</div><table><thead>{weekHeader}</thead><tbody>{weeks}</tbody></table></div>'}),onShow:function(e){e.attr("style","")},onChangeMonthYear:function(e,o){var c=new Date(e,Math.floor(o-1),1);if(calState=moment(c),!s){var m=moment(c).add(1,"months"),p=moment(c).subtract(1,"months");if(moment(c).diff(moment(r))<0&&moment(c).diff(moment(a))<0){if(void 0===statusLookup[p.format("YYYY-MM-DD")]){if(b="?hotel_id="+SYNXISID+"&startdate="+moment(c).subtract(i.months,"months").format("YYYY-MM-DD")+"&months="+Math.ceil(i.months+1)+"&currency="+i.currency+"&adults="+i.adults,a=moment(c).subtract(i.months,"months").format("YYYY-MM-DD"),s=!0,void 0!==i.promocode&&""!==i.promocode.value&&void 0!==i.promocode.value&&(b=b+"&promocode="+i.promocode.value),void 0!==i.ratecodes&&""!==i.ratecodes.value&&void 0!==i.ratecodes.value&&(b=b+"&ratecodes="+i.ratecodes.value),i.roomtype)for(var f=i.roomtype.split(","),h=f.length-1;h>=0;h--)b+="&roomtypes[]="+f[h];$(".icbe-wrapper").waveLoader({bars:8,overlay:!0,fixedHeight:!1}),$.when(d(b)).then(function(){$.when(l(t)).then(function(){u.datepick("setDate",new Date(sabreDateFormat(u.closest(".outer-wrapper").find('input[name="startdate"]').val())),new Date(sabreDateFormat(u.closest(".outer-wrapper").find('input[name="enddate"]').val()))),u.datepick("showMonth",e,o),s=!1})})}}else if(moment(c).diff(moment(r))>=0&&moment(c).diff(moment(n))>=0&&void 0===statusLookup[m.format("YYYY-MM-DD")]){if(b="?hotel_id="+SYNXISID+"&startdate="+moment(c).format("YYYY-MM-DD")+"&months="+Math.ceil(i.months+1)+"&currency="+i.currency+"&adults="+i.adults,n=moment(c).format("YYYY-MM-DD"),s=!0,void 0!==i.promocode&&""!==i.promocode.value&&void 0!==i.promocode.value&&(b=b+"&promocode="+i.promocode.value),void 0!==i.ratecodes&&""!==i.ratecodes.value&&void 0!==i.ratecodes.value&&(b=b+"&ratecodes="+i.ratecodes.value),i.roomtype)for(var f=i.roomtype.split(","),h=f.length-1;h>=0;h--)b+="&roomtypes[]="+f[h];$(".icbe-wrapper").waveLoader({bars:8,overlay:!0,fixedHeight:!1}),$.when(d(b)).then(function(){$.when(l(t)).then(function(){u.datepick("setDate",new Date(sabreDateFormat(u.closest(".outer-wrapper").find('input[name="startdate"]').val())),new Date(sabreDateFormat(u.closest(".outer-wrapper").find('input[name="enddate"]').val()))),u.datepick("showMonth",e,o),s=!1})})}}},onSelect:function(e){userChangedMonthYear=!1;var t=new Date(e[0]),a=new Date(e[1]);if(e.length>0){var n=u.closest(".outer-wrapper");n.find(".fake-input .fake-arrival").addClass("selected").html(p[t.getMonth()]+" "+t.getDate()),n.find('input[name="startdate"]').val(t.getFullYear()+"-"+("00"+(t.getMonth()+1)).slice(-2).toString()+"-"+("00"+t.getDate()).slice(-2).toString()),t.valueOf()<a.valueOf()&&(n.find(".fake-input .fake-departure").html(p[a.getMonth()]+" "+a.getDate()),n.find('input[name="enddate"]').val(a.getFullYear()+"-"+("00"+(a.getMonth()+1)).slice(-2).toString()+"-"+("00"+a.getDate()).slice(-2).toString()))}if($(".alert-box.alert").removeClass("shown"),a>t){for(var r=Math.round((a-t)/864e5),o=moment(t),i=moment(a),s=0,d=!1,c=0;c<r;c++){0!==c&&o.add(1,"days");var l=f[o.format("YYYY-MM-DD")];if("Close"===l.status){d=!0;break}l.minstay>1&&(s=l.minstay)}1===f[i.format("YYYY-MM-DD")].checkout&&(d=!1),d?($(".icbe-wrapper").errorAlert({msg:"One or more of your nights are not available. Please try again.",lightbox:!0}),$(".search-form").find('input[type="submit"]').attr("disabled","disabled")):s&&r<s?($(".icbe-wrapper").errorAlert({msg:"This stay requires a minimum of "+s+" nights.",lightbox:!0}),$(".search-form").find('input[type="submit"]').attr("disabled","disabled")):$(".search-form").find('input[type="submit"]').removeAttr("disabled")}},onDate:function(e,t){if(t){var a=e.getFullYear()+"-"+("00"+(e.getMonth()+1)).slice(-2).toString()+"-"+("00"+e.getDate()).slice(-2).toString();if(!f[a])return!1;var n="",r={};switch(f[a].rate&&""===i.promocode&&(n='<div class="cal-lowest-rates"><span class="currency">from '+i.currency+'</span><span class="rate">'+parseInt(f[a].rate)+"</span></div>"),f[a].status){case"Best Min":r={content:e.getDate()+n,dateClass:"best-min"};break;case"Best Day":r={content:e.getDate()+n,dateClass:"best-day"};break;case"Min Stay":r={content:e.getDate()+n,dateClass:"min-stay"};break;case"Close":r={content:e.getDate(),dateClass:"not-avail"};break;default:r={content:e.getDate()+n}}return r}return{dateClass:""}}});var v=o();u.find("table td").on("hover",function(){$(this).toggleClass("showRate")}),u.find(".datepick-cmd-prev, .datepick-cmd-next").on("click",function(){userChangedMonthYear=!0}),i.startdate&&i.enddate?(u.datepick("setDate",moment(i.startdate).format("MM/DD/YYYY"),moment(i.enddate).format("MM/DD/YYYY")),moment(calState).diff(moment(i.startdate))>0?u.datepick("showMonth",moment(i.startdate).year(),Math.ceil(moment(i.startdate).month()+1)):u.datepick("showMonth",moment(i.startdate).year(),moment(i.startdate).month())):v&&!userChangedMonthYear?u.datepick("showMonth",moment(v).year(),Math.ceil(moment(v).month()+1)):u.datepick("showMonth",moment(calState).year(),Math.ceil(moment(calState).month()+1)),s=!1,i.whenLoaded(u)}else{var y="Sorry, something went wrong. Please try again.";(i.promocode||i.ratecode)&&(y="Sorry, you have entered an invalid code. Please try again."),$(".icbe-wrapper").errorAlert({msg:y}),i.whenFailed(u)}}var u=$(this),m=(u.parents(".your-stay"),i.startDate.getFullYear()+"-"+("00"+(i.startDate.getMonth()+1)).slice(-2).toString()+"-"+("00"+i.startDate.getDate()).slice(-2).toString()),p="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),f={},h=[],g=[],b="";if(moment(calState).diff(moment(today).date(1).add(4,"months"))<=0?r=moment(m).date(1):(r=i.startdate&&moment(i.startdate).format("YYYY-MM-DD")!==moment(today).format("YYYY-MM-DD")?moment(i.startdate).date(1):moment(m).format("YYYY-MM")===moment(calState).format("YYYY-MM")?moment(m).date(1):moment(calState).date(1),moment(calState).diff(moment(i.startdate))>0&&moment(r).subtract(1,"month")),a=moment(r),n=moment(r).add(Math.floor(i.months-1),"months"),a=moment(a).date(1),n=moment(n).date(1),b="?hotel_id="+SYNXISID+"&startdate="+moment(r).format("YYYY-MM-DD")+"&months="+i.months+"&currency="+i.currency+"&adults="+i.adults,i.promocode&&(b+="&promocode="+i.promocode),i.ratecode)for(var v=i.ratecode.split(","),y=w.length-1;y>=0;y--)b+="&ratecodes[]="+v[y];if(i.roomtype)for(var w=i.roomtype.split(","),y=w.length-1;y>=0;y--)b+="&roomtypes[]="+w[y];i.whenLoading(u,p),$.ajax({url:"/ajax/rate-calendar"+b,dataType:"json"}).done(l).error(function(e){console.log("Failed"),i.whenFailed(u)})})},$.fn.errorAlert=function(e){var t={id:"",msg:"Uh oh! An error occured.",lightbox:!0,onClose:function(){}},a=$.extend({},t,e);return this.each(function(){if(a.lightbox){$("body").append('<div id="icbe-lightbox" class="tight-close"><div class="lightbox-content-wrapper"><div class="lightbox-content"><div class="lightbox-form-wrapper text-center"><h2 class="alert">Oops! Error</h2><p>'+a.msg+'</p></div></div><a class="close-button" href="#" title="Close Button"><span class="close-icon"><span class="icon"></span><span class="icon"></span></span></a></div></div>').css("overflow","hidden"),$("#icbe-lightbox").addClass("active"),$("#icbe-lightbox").on("click",".close-button, .close",function(e){e.preventDefault(),$(this).closest("#icbe-lightbox").removeClass("active"),$("body").removeAttr("style").find("#icbe-lightbox").remove(),"function"==typeof a.onClose&&a.onClose()})}else{var e=$('<div class="alert-box alert fixed"><a href="#" class="close">&#215;</a></div>'),t="ERROR: "+a.msg;""!==a.id&&(t="ERROR: "+a.msg),e.prepend(t),$(this).append(e).find(e).addClass("shown")}})};