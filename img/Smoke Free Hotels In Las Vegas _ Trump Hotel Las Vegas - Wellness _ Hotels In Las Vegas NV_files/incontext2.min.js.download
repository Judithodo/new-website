var availabilityRequest,today=new Date,tomorrow=new Date(today),userChangedMonthYear=!1,calState=moment(today),minStartRate="",HOTELNAME=$("body").data("property"),SYNXISID=$("body").data("synxisid"),LANGUAGEID=$("body").data("lang"),CURRENCY="USD",statusLookup=[];function productClick(e,t,a,n){}function makeParams(e){var t="?";for(var a in e)e[a]&&(t+=a+"="+e[a]+"&");return t.substring(0,t.length-1)}function iOSfix(e){if($("html").hasClass("touch")||"touch"===$("body").attr("data-whatinput")){var t=$("body");t.addClass("icbe-open icbe-type-"+e),$(".icbe-is-open").on("focus","input, select",function(e){t.addClass("icbe-fixfixed")}).on("blur","input, select",function(e){t.removeClass("icbe-fixfixed")})}}function onlyUnique(e,t,a){return a.indexOf(e)===t}!function(w,e){e.sabre=e.sabre||{},e.sabre.ICBE=e.sabre.ICBE||{};var k={};w.when(w.ajax("/templates/main/js/templates/incontext.html")).then(function(e){var t=w(e);Handlebars.registerPartial("currencySelector",t.filter("#currency-selector").html()),k.bookingSteps=t.filter("#booking-steps").html(),k.yourStay=Handlebars.compile(t.filter("#step-your-stay").html()),k.notFound=Handlebars.compile(t.filter("#not-found").html()),k.ratesStep=t.filter("#step-rates").html(),k.ratesListings=Handlebars.compile(t.filter("#rates-listings").html()),k.roomUpgrade=Handlebars.compile(t.filter("#room-upgrade").html()),k.addonStep=t.filter("#step-addons").html(),k.addonListings=Handlebars.compile(t.filter("#addon-listings").html()),k.cartView=Handlebars.compile(t.filter("#cart").html()),k.guestInfoForm=t.filter("#guest-information-form").html(),k.confirmation=Handlebars.compile(t.filter("#confirmation").html()),k.emailShare=Handlebars.compile(t.filter("#email-share").html()),Handlebars.registerHelper("getHotelId",function(){return SYNXISID}),Handlebars.registerHelper("getPrice",function(e,t){var a,n=parseFloat(e).toFixed(2);return a=(""+n).split("."),"dollars"===t?a[0]:"cents"===t?a[1]:isNaN(n)?"0.00":n}),Handlebars.registerHelper("dateFormatStr",function(e,t){return moment(new Date(convertDateStr(e,"/"))).format(t)}),Handlebars.registerHelper("timeFormatStr",function(e,t,a){return moment(e,t).format(a)}),Handlebars.registerHelper("getCurrencyCode",function(){return sabre.ICBE.myCart.getCurrency()}),Handlebars.registerHelper("getAddonType",function(e,t){var a=e.toLowerCase().replace("per ","");return a=a.replace(" per ","/"),"uppercase"===t?a.toUpperCase():a.replace(" per ","/").toLowerCase()}),Handlebars.registerHelper("toLowerCase",function(e){if("string"==typeof e)return e.toLowerCase()}),Handlebars.registerHelper("toUpperCase",function(e){if("string"==typeof e)return e.toUpperCase()}),Handlebars.registerHelper("if_string_eq",function(e,t,a){return e.toLowerCase()===t.toLowerCase()?a.fn(this):a.inverse(this)}),Handlebars.registerHelper("quantity_select",function(e){var t="";if(t="<select>",isFinite(e))for(var a=1;a<=e;a++)t+='<option value="'+a+'">'+a+"</option>";return t+="</select>",new Handlebars.SafeString(t)}),Handlebars.registerHelper("to_secure",function(e){return e.replace("http://","https://")}),Handlebars.registerHelper("to_secure_convert_spaces",function(e){return e.replace(/ /g,"%20").replace("http://","https://")}),Handlebars.registerHelper("pluralize",function(e,t){var a="";return t=t.toLowerCase(),e+" "+(a=1!=+e?{guest:"guests",child:"children",adult:"adults",room:"rooms"}[t]:t).charAt(0).toUpperCase()+a.slice(1)}),Handlebars.registerHelper("formatCurrency",function(e,t,a,n){return t||(t=u.getCurrency()),"boolean"!=typeof a&&(a=!1),"boolean"!=typeof n&&(n=!1),formatCurrency(e,t,a,n)}),Handlebars.registerHelper("isNotEmptyObject",function(e,t){w.isEmptyObject(e)||t.fn(this)})},function(e){console.error(e)});var t,a,o,r,n,C=e.sabre.bookingApi=function(){var o={addPackage:"/ajax/addpackagetocart",addRoom:"/ajax/addroomtocart",bookRooms:"/ajax/bookrooms",clearCart:"/ajax/clearcart",getAvailability:"/ajax/availability",getAddons:"/ajax/getaddons",getCartData:"/ajax/getcartdata",getReservations:"/ajax/getreservations",rateCalendar:"/ajax/rate-calendar",removeRoom:"/ajax/removeroomfromcart",removePackage:"/ajax/removepackagefromcart",setCurrency:"/ajax/setcurrency",getRoomTypes:"/ajax/getroomtypespage"},e={};function t(n){return function(e,t,a){return e=e||"",a=a||{},t?w[t](o[n]+e,a):w.ajax(o[n]+e,a)}}for(var a in o)e[a]=t(a);return e}(),l=e.sabre.ICBE.events={channels:{},publish:a=function(e){if(!l.channels[e])return!1;for(var t=Array.prototype.slice.call(arguments,1),a=0,n=l.channels[e].length;a<n;a++){var o=l.channels[e][a];o.callback.apply(o.context,t)}return this},subscribe:t=function(e,t){return l.channels[e]||(l.channels[e]=[]),l.channels[e].push({context:this,callback:t}),this},installTo:function(e){e.subscribe=t,e.publish=a}},S=e.sabre.ICBE=function(){var a,n,o,r=0,i="",s={},e=!1;l.installTo(s),s.subscribe("ready",function(e){if(!(a=w(e)).length)return t="there is no "+e+" on this page!",void console.error("ICBE: "+t);var t;w.when(u.ajaxClearCart()).then(u.ajaxGetCartData)}),s.subscribe("searchStepReady",function(e,t){CURRENCY=t||CURRENCY,i!==e&&(r=0,i=e,n=w("<div/>",{id:"step-wrapper"}),o=w("<div/>",{id:"cart-wrapper"}),a.empty().append(n,o),m.start(a),u.start(o,a.find("#cart")),u.ajaxClearCart(),u.ajaxSetCurrency(CURRENCY).promise().done(function(){w.when(u.ajaxGetCartData()).then(u.updateCart),"function"==typeof fn&&fn()}),p.start(n,e,CURRENCY)),m.makeActive(r)}),s.subscribe("resetICBE",function(){i="";var e=S.getRoomId(),t=CURRENCY;w(".media-gallery.show").length&&(e=w(".galleria-expand").attr("data-roomid"),t=w(".galleria-expand").attr("data-currency")),s.publish("searchStepReady",e,t)}),s.subscribe("currencyChanged",function(e,t){u.ajaxSetCurrency(e).promise().done(function(){CURRENCY=e,w.when(u.ajaxGetCartData()).then(u.updateCart),"function"==typeof t&&t()})});var t=function(e){r=(e=e||{step:0}).step,m.startOver(r),u.ajaxGetCartData().then(u.updateCart)};s.subscribe("promoCodeAdded",t),s.subscribe("promoCodeRemoved",t),s.subscribe("searchStepCompleted",function(e){m.complete(r),r=1,m.makeActive(r).startOver(r),u.ajaxClearCart().then(u.updateCart),n.children().detach(),u.ajaxGetCartData().then(f.start(n,e))}),s.subscribe("stepBackFromRates",function(){c(0)}),s.subscribe("rateAdded",function(){u.ajaxGetCartData().then(function(){u.updateCart();var e=u.getAttributes(),t=u.getRooms().rooms,a={hotel_id:SYNXISID,startdate:e.startdate,enddate:e.enddate,currency:e.currency,adults:t[0].adults,children:t[0].children,rateplan:t[0].rateCode};setTimeout(function(){m.complete(r),r=2,m.makeActive(r),n.children().detach(),h.start(n,a)},1500)})}),s.subscribe("rateRemoved",t.bind(s,{step:1})),s.subscribe("addonAdded",function(){u.ajaxGetCartData().then(function(){u.updateCart(),h.updateSelected(u.getPackages())})}),s.subscribe("addonRemoved",function(){u.ajaxGetCartData().then(function(){u.updateCart(),h.updateSelected(u.getPackages())})});var d=function(){n.children().detach(),g.start(n,u.getCurrentTotalUSD()),m.complete(r),r=3,m.makeActive(r),dataLayer.push({event:"reservation-review",SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/reservation-review","gtm.blacklist":["fsl","cl","tl","jel","hl"]})};s.subscribe("addonStepCompleted",d),s.subscribe("readyToBook",d),s.subscribe("bookingSuccess",function(e){b.start(a,e,function(){a.empty(),w("body").find(".loading-overlay").remove()})});var c=function(e){switch(r=e,m.makeActive(r),n.children().detach(),e){case 0:p.showCached(n);break;case 1:f.showCached(n);break;case 2:h.showCached(n)}};return s.subscribe("stepChanged",function(e){c(e)}),s.subscribe("editStay",function(){c(0)}),s.subscribe("editRate",function(){c(1)}),s.subscribe("editPackage",function(){c(2)}),s.show=function(){e=!0,TweenLite.fromTo(a,.35,{opacity:.4},{opacity:1,ease:Quint.easeOut,onStart:function(){a.css("display","block")},onComplete:function(){window.scrollTo(0,getScrollPos())}})},s.hide=function(){e=!1,TweenLite.to(a,.35,{height:0,ease:Quint.easeOut,onStart:function(){a.css("overflow","hidden")},onComplete:function(){a.removeAttr("style").css("display","none")}})},s.isOpen=function(){return e},s.getParent=function(){return a},s.getRoomId=function(){return i},s.setCurrentRoomId=function(e){i=e},s}(),u=S.myCart=function(t){var o,r,l,a={},n={},u=!1,m=!1;function e(){return C.getCartData().done(function(e){successful(e)&&(a=e.data.data,n=e.data.data,u=!0,m=!w.isEmptyObject(a.rooms))})}function p(){var e={};for(var t in a["@attributes"])e[t]=a["@attributes"][t];return e}function f(){var e=JSON.parse(JSON.stringify(n)),t=isArray(e.rooms.record)?e.rooms.record:[e.rooms.record];return{"@attributes":p(),rooms:w.map(t,function(e){return{roomNum:+e["@attributes"].id+1,roomName:e.name,adults:+e["@attributes"].adults,children:+e["@attributes"].children,promocode:w.isEmptyObject(e.promocode)?"":e.promocode,packages:isArray(e.packages.record)?e.packages.record:[e.packages.record],cartId:+e["@attributes"].id,roomId:e["@attributes"].roomcode,rateCode:e["@attributes"].ratecode,rateName:e.rate.name,rateInfo:e.rate,dailyRates:isArray(e.rate.days.record)?e.rate.days.record:[e.rate.days.record],price:{subtotal:(+e["@attributes"].subtotal).toFixed(2),fees:(+e["@attributes"].fees).toFixed(2),taxes:(+e["@attributes"].taxes).toFixed(2)}}})}}function i(e){if(e&&e.preventDefault(),!m)return!1;var o,t,n,r,i,s,d,c;w(this).toggleClass("active"),u&&(o={rooms:0,packages:0,fees:0,taxes:0,total:0},t=p(),n=f(),i=r=0,s=[],d=new Date(convertDateStr(t.startdate,"/")),c=new Date(convertDateStr(t.enddate,"/")),w.each(n.rooms,function(e,t){if(o.rooms+=+t.price.subtotal,o.fees+=+t.price.fees,o.taxes+=+t.price.taxes,o.packages=t.packages[0]?w.map(t.packages,function(e){return+e["@attributes"].total}).reduce(function(e,t){return e+t},0):0,t.averageRate=+(+t.price.subtotal/((c-d)/864e5)).toFixed(2),w.each(t.dailyRates,function(e,t){t&&s.push({date:t["@attributes"].date,price:+t["@attributes"].price})}),r+=+t.adults,i+=+t.children,t.packages[0]&&(t.hasPackages=!0),t.promocode&&(t.hasPromo=!0),e===n.rooms.length-1)for(var a in o)o[a]=(+o[a]).toFixed(2)}),o.byDayBreakdown=[],w.each(s,function(e,a){var n=!1;w.each(o.byDayBreakdown,function(e,t){if(t.date===a.date)return n=!0,t.price+=+a.price,t.price=parseFloat(t.price).toFixed(2),!1}),n||o.byDayBreakdown.push({date:a.date,price:parseFloat(a.price).toFixed(2)})}),t.totalAdults=r,t.totalChildren=i,t.totalRooms=n.rooms.length,n.stayInfo=t,n.subtotal=o,a=n,l.html(k.cartView(a)),w(document).foundation(),u=!1),l.toggleClass("active")}return{start:function(e,t){var a,n;l=e,o=(r=t).find(".total"),n=l,(a=r).on("click",i),n.on("click",".edit-stay",function(e){e.preventDefault(),i.call(a),S.publish("editStay"),w(".promocode-trigger").click()}),n.on("click",".edit-rate",function(e){e.preventDefault(),i.call(a),S.publish("editRate")}),n.on("click",".edit-package",function(e){e.preventDefault(),i.call(a),S.publish("editPackage")}),n.on("click",".view-price-breakdown, .price-breakdown .close",function(e){e.preventDefault(),w(this).parents(".column").find(".price-breakdown").toggleClass("active")}),n.on("click",".continue",function(e){e.preventDefault(),i.call(a),S.publish("readyToBook")}),n.on("mouseenter",".has-tip",function(e){var t=w(this),a=t.closest(".icbe-wrapper").offset().top,n=t.offset().top,o=t.attr("data-toggle");w("#"+o).css({position:"fixed","z-index":"20",top:n-a+"px","max-width":"20rem"})})},ajaxClearCart:function(){return w.when(C.clearCart()).then(e)},ajaxGetCartData:function(){return w.when(e())},ajaxSetCurrency:function(e){return w.when(C.setCurrency("?currency="+e))},getAttributes:function(){return p()},getCurrency:function(){return p().currency},getCurrentTotal:function(){return p().grandtotal},getCurrentTotalUSD:function(){return p().grandtotalusd},getPackages:function(){return w.map(f().rooms,function(e){return e.packages})},getRooms:function(){return f()},updateCart:function(){var e=t(parseFloat(a["@attributes"].grandtotal).toFixed(2),p().currency);e.match(/[a-zA-Z]/)?o.siblings(".title").css("display","none"):1025<window.innerWidth&&o.siblings(".title").css("display","inline-block"),o.text(e),m?r.find(".open-close-icon").css("display","block"):r.find(".open-close-icon").css("display","none")}}}(formatCurrency),m={start:function(e){var n;return e.find(".booking-steps").length||(e.prepend(k.bookingSteps),o=e.find(".booking-steps"),r=o.find(".step"),n=r,o.find(".step a").on("click",function(e){e.preventDefault();var t=w(this).parents(".step");if("cart"===this.id||t.hasClass("active"))return!1;if(!t.hasClass("completed")&&!t.hasClass("started"))return w(".icbe-wrapper").errorAlert({msg:"Please complete the current step before proceeding. "}),!1;var a=n.index(t);S.publish("stepChanged",a)})),this},makeActive:function(e){var t=r.eq(e);return r.removeClass("active"),t.addClass("active"),t.hasClass("completed")||t.addClass("started"),this},complete:function(e){return r.eq(e).removeClass("started").addClass("completed"),this},startOver:function(e){r.removeClass("started").eq(e).addClass("started").removeClass("completed");for(var t=0;t<r.length;t++)e<t&&r.eq(t).removeClass("completed");return this}},p={start:function(e,t,a){e.empty().append(k.yourStay),n=e.find(".your-stay"),"USD"!==a&&n.find(".currency-selector").val(a),function(i){var e,u=i.find(".search-form"),s=i.find(".date-picker"),a=S.getRoomId(),d={$promo:u.find('input[name="promocode"][type="hidden"]'),$group:u.find('input[name="ratecodes"][type="hidden"]')};void 0!==a&&(1<(a=(a=a.split(",")).filter(onlyUnique)).length?(i.find(".big-dropdowns").show(),i.removeClass("one-room"),i.find('[name="roomtype"]').closest(".columns").removeClass("hide"),w.when(C.getRoomTypes(makeParams({hotel_id:SYNXISID}))).done(function(e){if(e.success){a[0];var t=e.records;void 0===t.length&&(t=fixArray(t)),w.each(t,function(e,t){0<=a.indexOf(t.synxisid)&&i.find('[name="roomtype"]').append('<option value="'+t.synxisid+'" data-roomprice="'+t.minrate+'">'+t.roomname+"</option>")}),S.setCurrentRoomId(minStartRate),i.find('[name="roomtype"] option:eq(0)').remove(),i.find('[name="roomtype"] option[value="'+minStartRate+'"]').attr("selected","selected"),i.find('[name="roomtype"]').removeAttr("disabled")}else w(".icbe-wrapper").errorAlert({msg:"Sorry, something went wrong. Please try again."})}).fail(function(){w(".icbe-wrapper").errorAlert({msg:"Sorry, something went wrong. Please try again."})})):(i.find(".big-dropdowns").hide(),i.addClass("one-room"))),i.find('[name="roomtype"]').on("change",function(){var e=w(this),t=e.val(),a=e.find(":selected");if(""!==t){S.setCurrentRoomId(t),w(".icbe-wrapper").waveLoader({fixedHeight:!1});var n={roomtype:S.getRoomId(),currency:i.find(".currency-selector").val(),startdate:i.find('input[name="startdate"]').val(),enddate:i.find('input[name="enddate"]').val(),adults:i.find('select[name="adults"]').val(),whenLoaded:function(){w("body").find(".loading-overlay").remove()},whenFailed:function(){w("body").find(".loading-overlay").remove()}};s.rateCalendar(n),productClick(window.location.pathname.split("/"),a.text(),t,a.data("roomprice"))}}),i.find('[name="adults"]').on("change",function(){var e=w(this).val();if(""!==e){w(".icbe-wrapper").waveLoader({fixedHeight:!1});var t={roomtype:S.getRoomId(),currency:i.find(".currency-selector").val(),startdate:i.find('input[name="startdate"]').val(),enddate:i.find('input[name="enddate"]').val(),adults:e,whenLoaded:function(){w("body").find(".loading-overlay").remove()},whenFailed:function(){w("body").find(".loading-overlay").remove()}};s.rateCalendar(t)}}),i.find(".promo-codes").on("click","a",function(e){e.preventDefault();var t=w(this),a=t.closest("label"),n=t.closest(".promo-codes"),o=t.attr("data-code-type"),r=new TimelineLite;t.hasClass("active")||(a.find("a").removeClass("active"),t.addClass("active"),r.fromTo(n.find(".code-wrapper.active"),.25,{opacity:1,scale:1},{opacity:0,scale:.8,clearProps:"transform",ease:Back.easeIn,onComplete:function(){n.find(".code-wrapper.active").removeClass("active")}}).fromTo(n.find(".code-wrapper[data-code-type="+o+"]"),.25,{opacity:0,scale:.9},{opacity:1,scale:1,clearProps:"transform",ease:Back.easeOut,onStart:function(){n.find(".code-wrapper[data-code-type="+o+"]").addClass("active")}}))}),i.find(".code-wrapper").on("click",".apply-code:not(.remove-code)",function(e){e.preventDefault();var t=w(this),a=t.closest(".code-wrapper").find('input[type="text"]'),n=a.attr("name"),o=a.val();if(!o)return w(".icbe-wrapper").errorAlert({msg:"Cannot apply a code you haven't entered. Please enter a code and try again."}),!1;if("promocode"===n||"group"===n){w(".icbe-wrapper").waveLoader({fixedHeight:!1});var r={roomtype:S.getRoomId(),currency:i.find(".currency-selector").val(),startdate:i.find('input[name="startdate"]').val(),enddate:i.find('input[name="enddate"]').val(),adults:i.find('select[name="adults"]').val(),whenLoading:function(){t.animateButton({action:"loading"})},whenLoaded:function(){w("body").find(".loading-overlay").remove(),"promocode"===n?d.$promo.val(o):d.$group.val(o),t.animateButton({action:"animateSuccess"}),S.publish("promoCodeAdded")},whenFailed:function(){w("body").find(".loading-overlay").remove(),t.animateButton({action:"failed"})}};"promocode"===n?r.promocode=o:r.ratecode=o,s.rateCalendar(r)}else"iata"===n&&(u.prepend(w("<input/>",{name:"iata",value:o,type:"hidden"})),t.animateButton({action:"success"}))}),i.find(".code-wrapper").on("click",".remove-code",function(e){e.preventDefault();var t=w(this),a=t.attr("data-code-type"),n=a;"group"===a&&(n="ratecodes"),i.find('input[type="hidden"][name="'+n+'"]').val(""),t.animateButton({action:"removeCode"});var o={currency:i.find(".currency-selector").val(),startdate:i.find('input[name="startdate"]').val(),enddate:i.find('input[name="enddate"]').val(),adults:i.find('select[name="adults"]').val(),whenLoaded:function(){w("body").find(".loading-overlay").remove(),t.animateButton({action:"default"}),S.publish("promoCodeRemoved")}};"promocode"!==a&&"group"!==a||(d.$promo.val()&&(o.promocode=d.$promo.val()),d.$group.val()&&(o.ratecode=d.$group.val()),t.animateButton({action:"loading"}),w(".icbe-wrapper").waveLoader({fixedHeight:!1}),s.rateCalendar(o))}),i.find("form").on("submit",function(e){e.preventDefault();var t=new Date,a=u.find('input[name="startdate"]').val(),n=u.find('input[name="enddate"]').val(),o=new Date(convertDateStr(a,"/")),r=new Date(convertDateStr(n,"/"));if(moment(o).isSameOrAfter(moment(t))<r&&t<r){var i=u.find('select[name="adults"]').val(),s=u.find('select[name="children"]').val(),d=u.find('input[type="hidden"][name="promocode"]').val(),c=u.find('input[type="hidden"][name="iata"]').val(),l=u.find(".currency-selector").val();l=w(".currency-wrapper .currency-selector").val(),S.publish("searchStepCompleted",{startdate:a,enddate:n,adults:i,children:s,promocode:d,iata:c,currency:l})}else w(".icbe-wrapper").errorAlert({msg:"Please verify your check-in and check-out dates and try again."})}),i.find(".currency-selector").on("change",function(){var t=w(this).val(),a=u.find('input[name="startdate"]').val(),n=u.find('input[name="enddate"]').val(),o=u.find('select[name="adults"]').val();w(".icbe-wrapper").waveLoader({fixedHeight:!1}),S.publish("currencyChanged",t,function(){var e={hotel_id:SYNXISID,currency:t,roomtype:S.getRoomId(),startdate:a,enddate:n,adults:o,whenLoaded:function(){w("body").find(".loading-overlay").remove()}};d.$promo.val()&&(e.promocode=d.$promo.val()),d.$group.val()&&(e.ratecode=d.$group.val()),w(".selected-date").empty(),u.find('input[name="currency"]').val(t),s.rateCalendar(e)})}),i.find(".promocode-trigger").on("click",function(e){e.preventDefault(),w(this).parent(".promocode-field").toggleClass("promocode-is-open"),w(this).parent(".promocode-field").hasClass("promocode-is-open")?w(this).text("Close"):w(this).text("Add a Code")}),w(window).on("orientationchange",function(){i.find(".datepick-month").hide().show(0)}),w(window).on("resize",function(){clearTimeout(e),e=setTimeout(o,100)});var t=i.find(".rate-calendar-wrapper"),n=u.find(".check-in-out-column");function o(){window.innerWidth<=1025?n.has(t).length||n.append(t):n.has(t)&&i.append(t)}o()}(n),n.find(".date-picker").rateCalendar({currency:a,roomtype:minStartRate})},showCached:function(e){n&&e.append(n)}},f=function(){var p,f,h=[],g=[];function b(e,n,o){var r=!1;if(w.isEmptyObject(e))return rates;var t=isArray(e.record)?e.record:[e.record];w.each(t,function(e,t){if(r)return!1;var a=t.rooms.record;a=isArray(a)?a:[a],w.each(a,function(e,t){if(r)return!1;var a=n.split(",");w.each(a,function(e){t["@attributes"].roomid===a[e]&&(r=!0,o(t))})})})}function v(e,t){return e["@attributes"].averagerate-t["@attributes"].averagerate}function y(e){e&&"10007"===e.data.errors.record["@attributes"].id&&w(".icbe-wrapper").errorAlert({msg:"Sorry, we were unable to add this rate with your selected dates and guests."}),w(".icbe-wrapper").errorAlert({msg:"Sorry, something went wrong with adding this rate. Please try again."})}return{start:function(e,t){e.append(k.ratesStep),p=t,f=e.find(".rates-step"),p.hotel_id=SYNXISID,dataLayer.push({SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",SynxisArrivalSearch:moment(p.startdate).format("MM/DD/YYYY"),SynxisDepartureSearch:moment(p.enddate).format("MM/DD/YYYY"),SynxisArrivalSearchYYYYMMDD:moment(p.startdate).format("YYYY-MM-DD"),SynxisDepartureSearchYYYYMMDD:moment(p.enddate).format("YYYY-MM-DD"),event:"availability-results",BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/availability-results","gtm.blacklist":["fsl","cl","tl","jel","hl"]}),w.when(C.getAvailability(makeParams(p))).done(function(e){var t,a,n,o,r,i,s,d,c,l=e.data.data.availability,u="",m={};h=(t=g=l,a=S.getRoomId(),n=[],o=[],w.isEmptyObject(t)||b(t,a,function(e){n=isArray(e.rates.record)?e.rates.record:[e.rates.record],w.each(n,function(e,t){t["@attributes"].totalprice=(parseFloat(t["@attributes"].totalfees)+parseFloat(t["@attributes"].totaltaxes)+parseFloat(t["@attributes"].totalrate)).toFixed(2),t.dailyrates.record=isArray(t.dailyrates.record)?t.dailyrates.record:[t.dailyrates.record],o.push({name:t.name,id:t["@attributes"].ratecode,price:t["@attributes"].averagerate,brand:HOTELNAME,category:"Rate"})})}),n).sort(v),r=l,i=S.getRoomId(),s="",b(r,i,function(e){s=e["@attributes"].upgraderoomid}),(u=s)&&(d=h,c={},b(l,u,function(e){if("unassigned"===e.group.name.toLowerCase())return!1;c.isRoomUpgrade=!0;var t=isArray(e.rates.record)?e.rates.record:[e.rates.record];w.each(t,function(e,t){t.dailyrates.record=isArray(t.dailyrates.record)?t.dailyrates.record:[t.dailyrates.record]}),c.lowestrate=t.sort(v)[0],c.lowestrate["@attributes"].totalprice=(parseFloat(c.lowestrate["@attributes"].totalfees)+parseFloat(c.lowestrate["@attributes"].totaltaxes)+parseFloat(c.lowestrate["@attributes"].totalrate)).toFixed(2),c.roomname=e.name,c.roomid=e["@attributes"].roomid,c.image=e.image,c.group={id:e.group["@attributes"].id,name:e.group.name},c.pricedifference=(parseFloat(c.lowestrate["@attributes"].totalrate)-parseFloat(d[0]["@attributes"].totalrate)).toFixed(2)}),m=c),h.length?(S.publish("ratesUpdated",{rates:h,bestrate:h[0]}),f.find(".rates-listings .column").html(k.ratesListings(h)).promise().done(function(){if(!w.isEmptyObject(m)){var e=f.find(".cards .card");3<=e.length?e.eq(1).after(k.roomUpgrade(m)):(e.last().after(k.roomUpgrade(m)),e.removeClass("end"),f.find(".room-upgrade").addClass("end"))}!function(e){var d=e.find(".rates-listings");2<d.find(" > .column > ul > li").length&&d.find(" > .column > ul").slick({slidesToShow:1,mobileFirst:!0,responsive:[{breakpoint:800,settings:{slidesToShow:2,infinite:!1,swipe:!1}},{breakpoint:1100,settings:{slidesToShow:3,infinite:!1,swipe:!1}}],appendArrows:d}),d.find(".view-breakdown").on("click",function(e){e.preventDefault(),w(this).parents("li").find(".price-breakdown").slideToggle(150)}),d.find(".price-breakdown .close").on("click",function(e){e.preventDefault(),w(this).parents(".price-breakdown").slideToggle(150)}),d.find(".description > .column").each(function(){w(this).wrapInner('<div class="desc-body" />');var e=w(this).find("h3"),t=w(this).find(".terms"),a=w(this).find(".desc-body");t.insertAfter(a),e.insertBefore(a).wrap('<div class="heading-wrap" />')}),d.find(".see-all-roomtype").on("click",function(e){e.preventDefault()});var c=!1,l=!1;d.find(".select-rate").on("click",function(e){if(e.preventDefault(),c)return!1;var t,a,n,o=w(this),r=o.attr("data-rate"),i=o.attr("data-roomid"),s=(o.attr("data-rate"),o.attr("data-rate-price"),{defaultText:"Select",removeClass:"selected",removeText:"Selected",action:"loading"});o.animateButton(s),c=!0,b(g,i||S.getRoomId(),function(e){e["@attributes"].roomid===(i||S.getRoomId())&&(e["@attributes"].currency,e.name,e["@attributes"].roomid,moment(p.enddate).diff(moment(p.startdate),"days").toString())}),o.hasClass("selected")?(t=C.removeRoom,n=!(a="?id=0")):(t=C.addRoom,a=makeParams(p),a+="&hotel_id="+SYNXISID,a+="&rateplan="+r,a+="&roomtype="+(i||S.getRoomId()),l&&(a+="&id=0"),n=!0),w.when(t(a)).done(function(e){if(successful(e))return n?(s.action="default",d.find(".select-rate.selected").animateButton(s),s.action="animateSuccess",o.animateButton(s),S.publish("rateAdded"),l=!0):(s.action="default",o.animateButton(s),S.publish("rateRemoved"),l=!1),!0;s.action="failed",o.animateButton(s),y(e)}).always(function(){c=!1}).fail(function(){s.action="failed",o.animateButton(s),y()})})}(f)})):(f.html(k.notFound({message:'Sorry, there are no rates available for your <span class="pink">selected date</span> and <span class="pink">guests</span>. Please try your <a href="#" class="step-back">search</a> again.'})),f.find(".step-back").on("click",function(e){e.preventDefault(),S.publish("stepBackFromRates")}))}).fail(function(){f.html(k.notFound({message:'Sorry, an error has occurred. Please <a href="#" class="step-back">go back</a> to try again.'})),f.find(".step-back").on("click",function(e){e.preventDefault(),S.publish("stepBackFromRates")})})},showCached:function(e){if(f){e.append(f);var t=f.find(".rates-listings .cards");t.hasClass("slick-initialized")&&t.slick("setPosition")}}}}(),h=function(){var n,c=[],h=[],l={guarantee:["Hotel Guarantees"],dining:["Dining Offers"],spa:[],transportation:["TRANSPORTATION"],nightlife:["FLY BEYOND WITH LUXURY GREY GOOSE EXPERIENCES"],enhanced:[]};function o(e){var r=e.find(".addon-listings");e.find(".addon-menu").find(".fancy-selector").css("display","block"),r.find("ul").slick({slidesToShow:1,mobileFirst:!0,responsive:[{breakpoint:800,settings:{slidesToShow:2,infinite:!1,swipe:!1}},{breakpoint:1024,settings:{slidesToShow:3,infinite:!1,swipe:!1}}],appendArrows:r});var s=new Date(convertDateStr(_searchData.startdate,"/")),d=new Date(convertDateStr(_searchData.enddate,"/"));r.find(".date-begin").pickadate({format:"mm/dd/yyyy",formatSubmit:"yyyy-mm-dd",today:"",clear:"",min:[s.getFullYear(),s.getMonth(),s.getDate()],max:[d.getFullYear(),d.getMonth(),d.getDate()],container:w(document.body),onClose:function(){w(document.activeElement).blur()}});moment(_searchData.startdate+" "+r.find(".timepicker").data("increment")).format("m");r.find(".timepicker").pickatime({formatSubmit:"HH:i:00",interval:15,min:[0,0],max:void 0,container:w(document.body)}),r.find(".addon-description > .column").each(function(){w(this).wrapInner('<div class="desc-body" />');var e=w(this).find("h3"),t=w(this).find(".desc-body");e.insertBefore(t).wrap('<div class="heading-wrap" />'),iOSfix("addons")}),e.find('select[name="addon-filters"]').on("change",function(){var a,n,i=r.find(".column"),e=w(this).val();if(i.find("ul.cards").slick("unslick"),r.find(".date-begin").each(function(){w(this).pickadate("picker").stop()}),i.empty(),"all"===e)i.html(k.addonListings(c));else{var t=(a=[],n=l[e],w.each(c,function(e,t){-1!==n.indexOf(t.category)&&a.push(t)}),a);t.length?i.html(k.addonListings(t)):i.html(k.notFound({message:"Sorry, there are no available add ons for this category."}))}r.find(".cards").slick({slidesToShow:1,mobileFirst:!0,responsive:[{breakpoint:800,settings:{slidesToShow:2,infinite:!1,swipe:!1}},{breakpoint:1024,settings:{slidesToShow:3,infinite:!1,swipe:!1}}],appendArrows:r}),r.find(".date-begin").pickadate({format:"mm/dd/yyyy",formatSubmit:"yyyy-mm-dd",today:"",clear:"",min:[s.getFullYear(),s.getMonth(),s.getDate()],max:[d.getFullYear(),d.getMonth(),d.getDate()],container:w(document.body),onClose:function(){w(document.activeElement).blur()}});var o=moment(_searchData.startdate+" "+r.find(".timepicker").data("increment")).format("m");r.find(".timepicker").pickatime({formatSubmit:"HH:i:00",interval:o,min:[0,0],max:void 0,container:w(document.body)}),h.length&&w.each(h,function(e,t){var a=i.find('.select-button[data-addon-code="'+t["@attributes"].code+'"]');if(!a.length)return!1;a.addClass("selected").find(".button-content").text("Selected");var n=a.closest(".card"),o=n.find(".date-begin"),r=n.find(".fancy-selector select");(r.length&&r.val(t["@attributes"].adults),o.length)&&o.pickadate("picker").set("select",new Date(convertDateStr(t["@attributes"].startdate,"/")))})}),r.on("click",".select-addon",function(e){e.preventDefault();var t=w(this);if(t.hasClass("disabled"))return!1;var a=t.parents("li"),n=a.find('.addon-info input[name="date_submit"]'),o=a.find('.addon-info input[name="time_submit"]'),r=t.attr("data-addon-code"),i=a.find(".addon-info select").val(),s=n.val(),d=o.val();a.find(".addon-description h3").text(),t.attr("data-price"),a.attr("data-addon-category");if(n.length&&!s)return w(".icbe-wrapper").errorAlert({msg:"Please enter a date before selecting this add on."}),!1;if(o.length&&!d)return w(".icbe-wrapper").errorAlert({msg:"Please enter a time before selecting this add on."}),!1;var c,l,u,m={defaultText:"Select",removeClass:"selected",removeText:"Selected"},p="?roomid=0",f=!0;t.hasClass("selected")?(c=C.removePackage,p+="&packageid="+(l=r,u="",h[0]&&w.each(h,function(e,t){if(t["@attributes"].code===l)return u=t["@attributes"].id,!1}),u),f=!1):(c=C.addPackage,p+="&hotel_id="+_searchData.hotel_id,p+="&roomtype="+_searchData.roomId,p+="&currency="+_searchData.currency,p+="&startdate="+(s||_searchData.startdate),p+="&enddate="+(s||_searchData.enddate),p+="&adults="+(i||_searchData.adults),p+="&children="+(i?0:_searchData.children),p+="&packagecode="+r,p+="&rateplan="+_searchData.rateplan,p+="&increment="+d,setTimeout(w(".addon-menu .continue").text("Continue"),2e3)),m.action="loading",t.animateButton(m),w.when(c(p)).done(function(e){if(successful(e))return f?(m.action="animateSuccess",t.animateButton(m),S.publish("addonAdded")):(m.action="default",t.animateButton(m),S.publish("addonRemoved")),!1;m.action="failed",t.animateButton(m),g(e)}).fail(function(){m.action="failed",t.animateButton(m),g()})}),w(".addon-step .continue").on("click",function(e){e.preventDefault(),w(".booking-steps #cart").click(),S.publish("addonStepCompleted")})}function g(e){e&&"10012"===e.data.errors.record["@attributes"].id&&w(".icbe-wrapper").errorAlert({msg:"Sorry, this add on is not available."}),w(".icbe-wrapper").errorAlert({msg:"Sorry, something went wrong with selecting this add on. Please try again."})}return{updateSelected:function(e){h=e},start:function(e,t){e.append(k.addonStep),n=e.find(".addon-step"),_searchData=t,_searchData.hotel_id=SYNXISID;u.getAttributes();var a=u.getRooms().rooms;_searchData.roomId=a[0].roomId,dataLayer.push({event:"add-ons",SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/add-ons","gtm.blacklist":["fsl","cl","tl","jel","hl"]}),w.when(C.getAddons(makeParams(_searchData))).done(function(e){var t,a;successful(e)&&(t=e.data.data.record,a=isArray(t)?t:[t],moment(_searchData.startdate).format("MM/DD/YYYY"),moment(_searchData.enddate).format("MM/DD/YYYY"),(c=w.map(a,function(e){var t=[];return void 0===e&&(e={}),isArray(e.record)?(t=e.record[0])["@attributes"].needsdate=!0:t=void 0!==e.record?e.record:[],void 0!==t["@attributes"]&&""!=t["@attributes"].increment&&(t["@attributes"].needstime=!0),void 0!==t["@attributes"]&&("true"===t["@attributes"].countpeople||t["@attributes"].needsdate||t["@attributes"].needstime)&&(t["@attributes"].needsform=!0),t})).length?(n.find(".addon-listings .column").html(k.addonListings(c)),o(n)):(n.find(".addon-listings .column").html(k.notFound({message:"Sorry, there are no add ons for your selected room and dates."})),o(n),w(".addon-heading .continue").click()))})},showCached:function(e){n&&(e.append(n),n.find(".addon-listings ul").slick("setPosition"))}}}(),g=function(){var i,s=0,d=!1;function c(e){var a=e.find("form.guest-info-form");a.parsley(),a.prepend('<input name="hotel_id" type="hidden" value="'+SYNXISID+'" />'),a.on("submit",function(e){if(e.preventDefault(),w(".header-wrapper, .booking-console-wrapper").removeAttr("style"),d)return!1;w(".icbe-wrapper").waveLoader({bars:8,fixedHeight:!1}),function(e){var t=e.find("#firstName").val()+" "+e.find("#lastName").val();e.find("#expectedtotal").length?e.find("#expectedtotal").val(s):e.append('<input id="expectedtotal" type="hidden" name="expectedtotal" value="'+s+'"/>');e.find("#cc_name").length?e.find("#cc_name").val(t):e.append('<input id="#cc_name" type="hidden" name="cc_name" value="'+t+'"/>')}(a);var o=u.getAttributes(),t=u.getRooms().rooms,r=[];w.each(t,function(e,t){var a=moment(o.enddate).diff(moment(o.startdate),"days"),n=Number(t.price.subtotal)/a;r.push({name:t.roomName,id:t.roomId,price:n,brand:HOTELNAME,category:"Room",variant:t.rateCode,quantity:a.toString()}),void 0!==t.packages[0]&&w.each(t.packages,function(e,t){r.push({name:t.title,id:t["@attributes"].code,price:t["@attributes"].price,brand:HOTELNAME,category:t.category,quantity:t["@attributes"].adults.toString()})})}),w.when(C.bookRooms("","post",a.serialize())).done(function(e){!function(e){if(!successful(e))return n();var t=e.data.data.record,a=[];isArray(t)||(t=[t]);w.each(t,function(e,t){a.push({confirmation:t["@attributes"].confirmation,email:t.email})}),S.publish("bookingSuccess",a),d=!0}(e)}).fail(n)})}function n(){w("body").errorAlert({msg:"Sorry, something went wrong with finalizing your booking. Please check the required fields and try again. "}).find(".loading-overlay").remove()}return{start:function(e,t){var a={event:"customer-information",SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/customer-information","gtm.blacklist":["fsl","cl","tl","jel","hl"]};dataLayer.push(a);var o=u.getAttributes(),n=u.getRooms().rooms,r=[];w.each(n,function(e,t){var a=moment(o.enddate).diff(moment(o.startdate),"days"),n=Number(t.price.subtotal)/a;r.push({name:t.roomName,id:t.roomId,price:n,brand:HOTELNAME,category:"Room",variant:t.rateCode,quantity:a.toString()}),void 0!==t.packages[0]&&w.each(t.packages,function(e,t){r.push({name:t.title,id:t["@attributes"].code,price:t["@attributes"].price,brand:HOTELNAME,category:t.category,quantity:t["@attributes"].adults.toString()})})}),e.append(k.guestInfoForm),i=e.find(".guest-info-wrapper"),s=t,d=!1,c(i)},showCached:function(e,t){e.append(i),s=t}}}(),b=function(){function f(e){e.find(".print").on("click",function(e){e.preventDefault(),window.print()}),e.find(".share").on("click",function(e){e.preventDefault();var t=w(this);t.hasClass("active")?(t.html('<i class="plus">+</i>Share'),t.removeClass("active"),t.parents("li").find(".flyout").removeClass("active")):(t.addClass("active"),t.html("×"),t.parents("li").find(".flyout").addClass("active"))}),e.find(".view-price-breakdown, .price-breakdown .close").on("click",function(e){e.preventDefault(),w(this).parents(".column").find(".price-breakdown").toggleClass("active")}),e.find(".info-box-trigger").on("click",function(e){e.preventDefault();var t=w(this);t.hasClass("active")?(t.removeClass("active").text("i"),t.closest(".column").find(".flyout").removeClass("active")):(t.removeClass("active").text("×"),t.addClass("active"),t.closest(".column").find(".flyout").addClass("active"))}),e.find(".share-email").on("click",function(e){e.preventDefault(),w("#icbe-lightbox").addClass("active")});var s=!1;w("body").on("submit","#icbe-lightbox form",function(e){if(e.preventDefault(),s)return!1;var t=w(this),a=t.find(".submit-share"),n=w("#confirmations_confirmation, #confirmations_email").map(function(){return w(this).attr("name")+"="+w(this).val()}).get().join("&"),o=t.find('input[name="toemail"]').val().split(",");if(a.addClass("loading").find(".button-progress fa").addClass("fa-cog fa-spin"),t.parsley().isValid()){o=w.map(o,function(e){return e.trim()});var r=[],i={success:0,fails:0};w.each(o,function(e,t){r.push(w.ajax({url:"/ajax/emailbookings?"+n+"&toemail="+t+"&hotel_id="+SYNXISID+"&languageid="+LANGUAGEID,dataType:"json",success:function(e){var t=e.data.errors.record;jQuery.isEmptyObject(e.data.errors)?i.success++:(i.fails++,w(".icbe-wrapper").errorAlert({id:t["@attributes"].id,msg:t.message}))},error:function(){i.fails++,w(".icbe-wrapper").errorAlert({msg:"Sorry, something went wrong with emailing your reservation. Please try again."})}}))}),s=!0,w.when.apply(void 0,r).always(function(){a.removeClass("loading").find(".button-progress fa").removeClass("fa-cog fa-spin"),s=!1,i.success===o.length?(a.addClass("state-success"),setTimeout(function(){a.removeClass("state-success")},2e3)):(a.addClass("state-errors"),setTimeout(function(){a.removeClass("state-errors")},2e3))})}else t.parsley().validate(),a.removeClass("loading").addClass("state-error"),setTimeout(function(){a.removeClass("state-error")},2e3)}),w("body").on("click","#icbe-lightbox .close-button",function(e){e.preventDefault();var t=w(this).closest("#icbe-lightbox");t.removeClass("active"),t.find(".submit-share").removeClass("disabled").find(".button-content").text("Share"),t.find('input[name="toemail"]').val(""),w("body").removeAttr("style")}),w(".confirmation-details").foundation(),w(".confirmation-details").on("mouseenter",".has-tip",function(e){var t=w(this),a=t.closest(".icbe-wrapper").offset().top,n=t.offset().top,o=t.attr("data-toggle");w("#"+o).css({position:"fixed","z-index":"20",top:n-a+"px","max-width":"20rem"})})}return{start:function(m,e,p){w.when(C.getReservations(function(e){for(var t="",a=0;a<e.length;a++)t+=0===a?"?":"&",t+="hotel_id="+SYNXISID,t+="&confirmations["+a+"][confirmation]="+e[a].confirmation,t+="&confirmations["+a+"][email]="+e[a].email;return t}(e))).done(function(e){if("function"==typeof p&&p(),successful(e)){var t=function(e){var t=e.record;if(!w.isEmptyObject(t.packages.record)&&!isArray(t.packages.record)){var a=0;t.packages.record=[t.packages.record],w.each(t.packages.record,function(e,t){a+=+t["@attributes"].total}),t["@attributes"].packagetotal=a}return t.rate.days.record=isArray(t.rate.days.record)?t.rate.days.record:[t.rate.days.record],e}(e.data.data);S.publish("reservationRetrieved",t);var a=t.record["@attributes"].startdate,n=t.record["@attributes"].enddate,o=moment(a).diff(moment(new Date),"days").toString(),r=Math.floor(9e15*Math.random())+1e15,i=[],s=0,d=moment(n).diff(moment(a),"days"),c=(t["@attributes"].grandtotalusd,0),l="",u=isArray(t.record)?t.record:[t.record];w.each(u,function(e,t){t["@attributes"].taxes,i.push({sku:SYNXISID+" - "+t["@attributes"].roomcode+" - "+t["@attributes"].ratecode,name:t.name,category:"Room",price:t["@attributes"].rate,quantity:moment(n).diff(moment(a),"days").toString()}),l=t.name,s++,c+=t["@attributes"].subtotal,w.isEmptyObject(t.packages.record)||w.each(t.packages.record,function(e,t){i.push({sku:SYNXISID+" - "+t["@attributes"].code,name:t.name,price:t["@attributes"].price,category:t.category,quantity:t["@attributes"].quantity})})}),dataLayer.push({event:"booking-confirmation",SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",SynxisDaystoArrival:o.toString(),SynxisArrivalSearch:moment(a).format("MM/DD/YYYY"),SynxisDepartureSearch:moment(n).format("MM/DD/YYYY"),BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/booking-confirmation",transactionId:SYNXISID+" - "+HOTELNAME+" - "+r.toString()+" - icbe",transactionRoomQty:s.toString(),transactionNightsQty:d.toString(),transactionAffiliation:HOTELNAME,transactionTotal:t["@attributes"].grandtotal,transactionCurrency:t["@attributes"].currency,transactionRateName:t.record.rate.name,transactionRateCode:t.record.rate["@attributes"].code,transactionDailyRate:t.record["@attributes"].rate,transactionRateQty:1,transactionRoomName:l,transactionProducts:i,rtADR:c/d,"gtm.blacklist":["fsl","cl","tl","jel","hl"]}),w("body").append(k.emailShare(t)),t.record.hotel=HOTELNAME,t.record.hotelURL=window.location.origin+"/"+window.location.pathname.split("/")[1],m.append(k.confirmation(t)).promise().done(function(){f(m.find(".confirmation-wrapper"))})}})}}}()}(jQuery,window),$(function(){var s=sabre.ICBE,e=$(".interior-body");if(768<=window.innerWidth||"mouse"===$("body").attr("data-whatinput")){s.publish("ready","#icbe");s.getParent();e.find(".roomtyperates-button").on("focus click",function(e){if(e.preventDefault(),window.innerWidth<768)return window.location.href=this.href,!1;$(".icbe-wrapper");$(".bookingconsole").hasClass("bookingconsole-is-open icbe-is-open")||(TweenMax.from(".bookingconsole",.3,{opacity:0}),$("body").addClass("noscroll")),$(".bookingconsole").addClass("bookingconsole-is-open icbe-is-open").addClass("short").removeClass("full"),iOSfix("room"),Foundation.MediaQuery.atLeast("large");var t=$(this),a=(t.hasClass("active"),t.attr("data-roomid"));minStartRate=t.attr("data-minratecode");var n=t.attr("data-currency"),o=t.attr("data-roomname"),r=t.attr("data-roomprice");productClick(window.location.pathname.split("/"),o,minStartRate,r),dataLayer.push({SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/check-availability",event:"check-availability","gtm.blacklist":["fsl","cl","tl","jel","hl"]}),s.publish("searchStepReady",a,n)}),$(".minigallery-rooms").on("focus click",function(e){console.log("test"),e.preventDefault();$(".icbe-wrapper");$(".bookingconsole").hasClass("bookingconsole-is-open icbe-is-open")||(TweenMax.from(".bookingconsole",.3,{opacity:0}),$("body").addClass("noscroll")),$(".bookingconsole").addClass("bookingconsole-is-open icbe-is-open").addClass("short").removeClass("full"),iOSfix("mini"),Foundation.MediaQuery.atLeast("large");var t=$(this),a=(t.hasClass("active"),t.attr("data-roomid")),n=t.attr("data-currency"),o=t.attr("data-minratecode"),r=t.attr("data-roomname"),i=t.attr("data-roomprice");productClick(window.location.pathname.split("/"),r,o,i),dataLayer.push({SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/check-availability",event:"check-availability","gtm.blacklist":["fsl","cl","tl","jel","hl"]}),s.publish("searchStepReady",a,n)}),$("body").off("click",'.galleria-expand[data-type="room"]'),$("body").on("click",'.galleria-expand[data-type="room"]',function(e){if(e.preventDefault(),window.innerWidth<768)return window.location.href=this.href,!1;$(".icbe-wrapper");if($(".bookingconsole").hasClass("bookingconsole-is-open icbe-is-open"))TweenMax.to(".bookingconsole",.5,{opacity:0,onComplete:function(){$(".bookingconsole").removeClass("bookingconsole-is-open icbe-is-open icbe-gallery"),$(".bookingconsole").attr("style",""),$("body").removeClass("noscroll"),s.publish("resetICBE")}});else{$(".bookingconsole").addClass("bookingconsole-is-open icbe-is-open icbe-gallery").addClass("short").removeClass("full"),TweenMax.from(".bookingconsole",.5,{delay:.5,opacity:0}),$("body").addClass("noscroll"),iOSfix("gallery"),Foundation.MediaQuery.atLeast("large")&&2;var t=$(this),a=(t.hasClass("active"),t.attr("data-roomid")),n=t.attr("data-roomname"),o=t.attr("data-roomprice"),r=t.attr("data-currency");productClick(window.location.pathname.split("/"),n,a,o),dataLayer.push({SynxisHotelID:SYNXISID,SynxisLanguage:"en-US",BookingEngineStep:"icbe/"+SYNXISID+"/booking-engine/check-availability",event:"check-availability","gtm.blacklist":["fsl","cl","tl","jel","hl"]}),s.publish("searchStepReady",a,r)}}),$("body").on("click touchstart",".galleria-image",function(){s.publish("resetICBE")}),$(".bookingconsole > .close").on("click",function(){$(this).parent().hasClass("icbe-is-open")&&!$("body").hasClass("icbe-type-offer")&&($("body").removeClass("icbe-open icbe-type-room icbe-type-mini icbe-type-gallery icbe-type-undefined"),s.publish("resetICBE"))})}if($("html").hasClass("touch")){var t=$("body");$(document).on("focus","select",function(e){t.addClass("fixfixed")}).on("blur","select",function(e){t.removeClass("fixfixed")})}}),$.fn.toggleText=function(){return this.each(function(){var e=$(this),t=e.text();e.text(e.attr("data-toggle-text")).attr("data-toggle-text",t)})},$.fn.animateButton=function(e){"use strict";var n=$.extend({},{defaultText:"Apply",removeClass:"remove-code",removeText:"remove",disabledText:""},e);return this.each(function(){var e=$(this),t=n.$input||e.closest(".code-wrapper").find('input[type="text"]'),a=n.$content||e.find(".button-content");"removeCode"===n.action&&(e.removeClass(n.removeClass),t.removeAttr("disabled").val(""),a.text(n.defaultText)),"loading"===n.action&&(e.addClass("loading disabled"),t.attr("disabled","disabled"),a.text(n.disabledText)),"default"===n.action&&(e.removeClass("loading state-error disabled "+n.removeClass),t.removeAttr("disabled"),a.text(n.defaultText)),"success"===n.action&&(e.addClass(n.removeClass),t.attr("disabled","disabled"),a.text(n.removeText)),"animateSuccess"===n.action&&TweenLite.to(e.find(".progress-inner"),.1,{height:e.height(),ease:Linear.easeNone,onComplete:function(){e.removeClass("loading disabled").addClass("state-success"),e.find(".progress-inner").css({height:"0%",opacity:"0"}),setTimeout(function(){e.removeClass("state-success").addClass(n.removeClass),a.text(n.removeText),t.attr("disabled","disabled")},1500)}}),"failed"===n.action&&TweenLite.to(e.find(".progress-inner"),0,{height:e.height(),ease:Linear.easeNone,onComplete:function(){e.addClass("state-error").delay(.1).removeClass("loading"),e.find(".progress-inner").css({height:"0%",opacity:"0"}),setTimeout(function(){n.action="default",e.animateButton(n)},3e3)}},.2)})},$.fn.rateCalendar=function(e){"use strict";var u,h,g,b,t={months:6,promocode:"",ratecode:"",roomType:"",startDate:new Date,currency:"USD",roomtype:"",adults:1,whenLoaded:function(){},whenLoading:function(){},whenFailed:function(){}},v=$.extend({},t,e),y=!0;return this.each(function(){var m=$(this),e=(m.parents(".your-stay"),v.startDate.getFullYear()+"-"+("00"+(v.startDate.getMonth()+1)).slice(-2).toString()+"-"+("00"+v.startDate.getDate()).slice(-2).toString()),p="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),f={},i=[],d=[],c="";if(moment(calState).diff(moment(today).date(1).add(4,"months"))<=0?b=moment(e).date(1):(b=v.startdate&&moment(v.startdate).format("YYYY-MM-DD")!==moment(today).format("YYYY-MM-DD")?moment(v.startdate).date(1):moment(e).format("YYYY-MM")===moment(calState).format("YYYY-MM")?moment(e).date(1):moment(calState).date(1),0<moment(calState).diff(moment(v.startdate))&&moment(b).subtract(1,"month")),h=moment(b),g=moment(b).add(Math.floor(v.months-1),"months"),h=moment(h).date(1),g=moment(g).date(1),c="?hotel_id="+SYNXISID+"&startdate="+moment(b).format("YYYY-MM-DD")+"&months="+v.months+"&currency="+v.currency+"&adults="+v.adults,v.promocode&&(c+="&promocode="+v.promocode),v.ratecode)for(var t=v.ratecode.split(","),a=n.length-1;0<=a;a--)c+="&ratecodes[]="+t[a];if(v.roomtype){var n=v.roomtype.split(",");for(a=n.length-1;0<=a;a--)c+="&roomtypes[]="+n[a]}function l(e,t){var a=void 0!==t&&t;return $.Deferred(function(t){availabilityRequest=$.ajax({type:"GET",url:"/ajax/rate-calendar"+e,cache:a,success:function(e){u=e,$("body").find(".loading-overlay").remove(),t.resolve()}}).error(function(e){console.log("failed!"),console.log(e.status),$("body").find(".loading-overlay").remove(),$("body").errorAlert({msg:e.status}),t.resolve()})})}v.whenLoading(m,p),$.ajax({url:"/ajax/rate-calendar"+c,dataType:"json"}).done(function s(e){if(successful(e)){var t=e.data.data.record,a=1;f=function(e,t){for(var a=0;a<t.length;a++)e[t[a].date]={},e[t[a].date].rate=61172===SYNXISID?t[a].amountaftertax:t[a].amountbeforetax,d.push({closed:"Close"===t[a].status,date:t[a].date}),1<+t[a].minstay&&1==+t[a].bestday&&"Close"!==t[a].status?e[t[a].date].status="Best Min":1==+t[a].bestday?e[t[a].date].status="Best Day":1<+t[a].minstay?e[t[a].date].status="Min Stay":e[t[a].date].status=t[a].status,e[t[a].date].minstay=t[a].minstay,e[t[a].date].checkout=Number(t[a].checkout);return e}(f,t),Foundation.MediaQuery.atLeast("large")&&(a=2),r=t,jQuery.isEmptyObject(r)||r.forEach(function(e,t){d.push({closed:"Close"===e.status,date:e.date}),i[e.date]=e.amountbeforetax,1<parseInt(e.minstay,10)&&1===parseInt(e.bestday,10)&&"Close"!==e.status?statusLookup[e.date]={status:"Best Min",minstay:e.minstay,checkout:Number(e.checkout)}:1===parseInt(e.bestday,10)&&"Close"!==e.status?statusLookup[e.date]={status:"Best Day",minstay:e.minstay,checkout:Number(e.checkout)}:1<parseInt(e.minstay,10)?statusLookup[e.date]={status:"Min Stay",minstay:e.minstay,checkout:Number(e.checkout)}:statusLookup[e.date]={status:e.status,minstay:e.minstay,checkout:Number(e.checkout)}}),m.datepick("destroy"),m.datepick({rangeSelect:!0,monthsToShow:a,useMouseWheel:!1,changeMonth:!1,todayText:"",minDate:new Date,maxDate:$.datepick.determineDate("+12m -1d",new Date),prevText:'<svg class="svg-cal-arrow" xmlns="http://www.w3.org/2000/svg" width="13" height="25" viewBox="0 0 13.661 25"><path d="M13.66 12.49L1.217 0 0 .302 12.153 12.5 0 24.698 1.216 25 13.66 12.51l-.04-.01"/></svg>',nextText:'<svg class="svg-cal-arrow" xmlns="http://www.w3.org/2000/svg" width="13" height="25" viewBox="0 0 13.661 25"><path d="M13.66 12.49L1.217 0 0 .302 12.153 12.5 0 24.698 1.216 25 13.66 12.51l-.04-.01"/></svg>',renderer:$.extend({},$.datepick.defaultRenderer,{picker:$.datepick.defaultRenderer.picker.replace(/\{link:today\}/,""),month:'<div class="datepick-month"><div class="datepick-month-header">{monthHeader:MM yyyy}</div><table><thead>{weekHeader}</thead><tbody>{weeks}</tbody></table></div>'}),onShow:function(e){e.attr("style","")},onChangeMonthYear:function(e,t){var a=new Date(e,Math.floor(t-1),1);if(calState=moment(a),!y){var n=moment(a).add(1,"months"),o=moment(a).subtract(1,"months");if(moment(a).diff(moment(b))<0&&moment(a).diff(moment(h))<0){if(void 0===statusLookup[o.format("YYYY-MM-DD")]){if(c="?hotel_id="+SYNXISID+"&startdate="+moment(a).subtract(v.months,"months").format("YYYY-MM-DD")+"&months="+Math.ceil(v.months+1)+"&currency="+v.currency+"&adults="+v.adults,h=moment(a).subtract(v.months,"months").format("YYYY-MM-DD"),y=!0,void 0!==v.promocode&&""!==v.promocode.value&&void 0!==v.promocode.value&&(c=c+"&promocode="+v.promocode.value),void 0!==v.ratecodes&&""!==v.ratecodes.value&&void 0!==v.ratecodes.value&&(c=c+"&ratecodes="+v.ratecodes.value),v.roomtype)for(var r=v.roomtype.split(","),i=r.length-1;0<=i;i--)c+="&roomtypes[]="+r[i];$(".icbe-wrapper").waveLoader({bars:8,overlay:!0,fixedHeight:!1}),$.when(l(c)).then(function(){$.when(s(u)).then(function(){m.datepick("setDate",new Date(sabreDateFormat(m.closest(".outer-wrapper").find('input[name="startdate"]').val())),new Date(sabreDateFormat(m.closest(".outer-wrapper").find('input[name="enddate"]').val()))),m.datepick("showMonth",e,t),y=!1})})}}else if(0<=moment(a).diff(moment(b))&&0<=moment(a).diff(moment(g))&&void 0===statusLookup[n.format("YYYY-MM-DD")]){if(c="?hotel_id="+SYNXISID+"&startdate="+moment(a).format("YYYY-MM-DD")+"&months="+Math.ceil(v.months+1)+"&currency="+v.currency+"&adults="+v.adults,g=moment(a).format("YYYY-MM-DD"),y=!0,void 0!==v.promocode&&""!==v.promocode.value&&void 0!==v.promocode.value&&(c=c+"&promocode="+v.promocode.value),void 0!==v.ratecodes&&""!==v.ratecodes.value&&void 0!==v.ratecodes.value&&(c=c+"&ratecodes="+v.ratecodes.value),v.roomtype)for(var r=v.roomtype.split(","),i=r.length-1;0<=i;i--)c+="&roomtypes[]="+r[i];$(".icbe-wrapper").waveLoader({bars:8,overlay:!0,fixedHeight:!1}),$.when(l(c)).then(function(){$.when(s(u)).then(function(){m.datepick("setDate",new Date(sabreDateFormat(m.closest(".outer-wrapper").find('input[name="startdate"]').val())),new Date(sabreDateFormat(m.closest(".outer-wrapper").find('input[name="enddate"]').val()))),m.datepick("showMonth",e,t),y=!1})})}}},onSelect:function(e){userChangedMonthYear=!1;var t=new Date(e[0]),a=new Date(e[1]);if(0<e.length){var n=m.closest(".outer-wrapper"),o=n.find(".fake-input .fake-arrival");o.addClass("selected").html(p[t.getMonth()]+" "+t.getDate()),n.find('input[name="startdate"]').val(t.getFullYear()+"-"+("00"+(t.getMonth()+1)).slice(-2).toString()+"-"+("00"+t.getDate()).slice(-2).toString()),t.valueOf()<a.valueOf()&&(n.find(".fake-input .fake-departure").html(p[a.getMonth()]+" "+a.getDate()),n.find('input[name="enddate"]').val(a.getFullYear()+"-"+("00"+(a.getMonth()+1)).slice(-2).toString()+"-"+("00"+a.getDate()).slice(-2).toString()))}if($(".alert-box.alert").removeClass("shown"),t<a){for(var r=Math.round((a-t)/864e5),i=moment(t),s=moment(a),d=0,c=!1,l=0;l<r;l++){0!==l&&i.add(1,"days");var u=f[i.format("YYYY-MM-DD")];if("Close"===u.status){c=!0;break}1<u.minstay&&(d=u.minstay)}1===f[s.format("YYYY-MM-DD")].checkout&&(c=!1),c?($(".icbe-wrapper").errorAlert({msg:"One or more of your nights are not available. Please try again.",lightbox:!0}),$(".search-form").find('input[type="submit"]').attr("disabled","disabled")):d&&r<d?($(".icbe-wrapper").errorAlert({msg:"This stay requires a minimum of "+d+" nights.",lightbox:!0}),$(".search-form").find('input[type="submit"]').attr("disabled","disabled")):$(".search-form").find('input[type="submit"]').removeAttr("disabled")}},onDate:function(e,t){if(t){var a=e.getFullYear()+"-"+("00"+(e.getMonth()+1)).slice(-2).toString()+"-"+("00"+e.getDate()).slice(-2).toString();if(!f[a])return!1;var n="",o={};switch(f[a].rate&&""===v.promocode&&(n='<div class="cal-lowest-rates"><span class="currency">from '+v.currency+'</span><span class="rate">'+parseInt(f[a].rate)+"</span></div>"),f[a].status){case"Best Min":o={content:e.getDate()+n,dateClass:"best-min"};break;case"Best Day":o={content:e.getDate()+n,dateClass:"best-day"};break;case"Min Stay":o={content:e.getDate()+n,dateClass:"min-stay"};break;case"Close":o={content:e.getDate(),dateClass:"not-avail"};break;default:o={content:e.getDate()+n}}return o}return{dateClass:""}}});var n=function(){for(var e="",t=0,a=d.length;t<a;t++)if(!d[t].closed){e=d[t].date;break}return e}();m.find("table td").on("hover",function(){$(this).toggleClass("showRate")}),m.find(".datepick-cmd-prev, .datepick-cmd-next").on("click",function(){userChangedMonthYear=!0}),v.startdate&&v.enddate?(m.datepick("setDate",moment(v.startdate).format("MM/DD/YYYY"),moment(v.enddate).format("MM/DD/YYYY")),0<moment(calState).diff(moment(v.startdate))?m.datepick("showMonth",moment(v.startdate).year(),Math.ceil(moment(v.startdate).month()+1)):m.datepick("showMonth",moment(v.startdate).year(),moment(v.startdate).month())):n&&!userChangedMonthYear?m.datepick("showMonth",moment(n).year(),Math.ceil(moment(n).month()+1)):m.datepick("showMonth",moment(calState).year(),Math.ceil(moment(calState).month()+1)),y=!1,v.whenLoaded(m)}else{var o="Sorry, something went wrong. Please try again.";(v.promocode||v.ratecode)&&(o="Sorry, you have entered an invalid code. Please try again."),$(".icbe-wrapper").errorAlert({msg:o}),v.whenFailed(m)}var r}).error(function(e){console.log("Failed"),console.log(e.status),v.whenFailed(m)})})},$.fn.errorAlert=function(e){var a=$.extend({},{id:"",msg:"Uh oh! An error occured.",lightbox:!0,onClose:function(){}},e);return this.each(function(){if(a.lightbox){$("body").append('<div id="icbe-lightbox" class="tight-close"><div class="lightbox-content-wrapper"><div class="lightbox-content"><div class="lightbox-form-wrapper text-center"><h2 class="alert">Oops! Error</h2><p>'+a.msg+'</p></div></div><a class="close-button" href="#" title="Close Button"><span class="close-icon"><span class="icon"></span><span class="icon"></span></span></a></div></div>').css("overflow","hidden"),$("#icbe-lightbox").addClass("active"),$("#icbe-lightbox").on("click",".close-button, .close",function(e){e.preventDefault(),$(this).closest("#icbe-lightbox").removeClass("active"),$("body").removeAttr("style").find("#icbe-lightbox").remove(),"function"==typeof a.onClose&&a.onClose()})}else{var e=$('<div class="alert-box alert fixed"><a href="#" class="close">&#215;</a></div>'),t="ERROR: "+a.msg;""!==a.id&&(t="ERROR: "+a.msg),e.prepend(t),$(this).append(e).find(e).addClass("shown")}})};